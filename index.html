<!DOCTYPE html>
<html lang="zh-CN">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>å…­åˆå½©å…¬å¼éªŒè¯å™¨ - å®Œæ•´ç‰ˆ</title>
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }

       body {
           font-family: 'Microsoft YaHei', Arial, sans-serif;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           padding: 0;
           min-height: 100vh;
       }

       .container {
           max-width: 1800px;
           margin: 0 auto;
           background: white;
           box-shadow: 0 10px 40px rgba(0,0,0,0.2);
           overflow: hidden;
       }

       .header {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
           padding: 20px 30px;
           text-align: center;
       }

       .header h1 {
           font-size: 28px;
           margin-bottom: 5px;
       }

       .header p {
           font-size: 13px;
           opacity: 0.9;
       }

       .menu-bar {
           background: #f8f9fa;
           border-bottom: 2px solid #e0e0e0;
           display: flex;
           padding: 0;
           position: sticky;
           top: 0;
           z-index: 100;
           box-shadow: 0 2px 5px rgba(0,0,0,0.1);
       }

       .menu-item {
           position: relative;
           padding: 12px 20px;
           cursor: pointer;
           transition: all 0.3s;
           border-right: 1px solid #e0e0e0;
           display: flex;
           align-items: center;
           gap: 5px;
           font-weight: 500;
           color: #333;
       }

       .menu-item:hover {
           background: #667eea;
           color: white;
       }

       .menu-item.active {
           background: #667eea;
           color: white;
       }

       .menu-dropdown {
           display: none;
           position: absolute;
           top: 100%;
           left: 0;
           background: white;
           min-width: 320px;
           box-shadow: 0 5px 15px rgba(0,0,0,0.2);
           border-radius: 0 0 8px 8px;
           padding: 15px;
           z-index: 1000;
       }

       .menu-item:hover .menu-dropdown {
           display: block;
       }

       .dropdown-section {
           margin-bottom: 15px;
           padding-bottom: 15px;
           border-bottom: 1px solid #e0e0e0;
       }

       .dropdown-section:last-child {
           border-bottom: none;
           margin-bottom: 0;
           padding-bottom: 0;
       }

       .dropdown-section h4 {
           color: #667eea;
           font-size: 13px;
           margin-bottom: 10px;
           font-weight: bold;
       }

       .dropdown-option {
           display: flex;
           align-items: center;
           gap: 10px;
           margin-bottom: 8px;
           font-size: 13px;
       }

       .dropdown-option label {
           flex: 1;
           cursor: pointer;
           color: #333;
       }

       .dropdown-option select,
       .dropdown-option input[type="text"] {
           flex: 1;
           padding: 5px 8px;
           border: 1px solid #ddd;
           border-radius: 4px;
           font-size: 13px;
       }

       .dropdown-option input[type="checkbox"] {
           width: 16px;
           height: 16px;
           cursor: pointer;
       }

       .dropdown-btn {
           width: 100%;
           padding: 8px;
           background: #667eea;
           color: white;
           border: none;
           border-radius: 5px;
           cursor: pointer;
           font-size: 13px;
           margin-top: 10px;
           transition: all 0.3s;
       }

       .dropdown-btn:hover {
           background: #5568d3;
       }

       .main-content {
           padding: 20px 30px;
       }

       .section {
           margin-bottom: 25px;
           padding: 20px;
           background: #f8f9fa;
           border-radius: 10px;
           border: 1px solid #e0e0e0;
       }

       .section-title {
           font-size: 18px;
           color: #667eea;
           margin-bottom: 15px;
           font-weight: bold;
           display: flex;
           align-items: center;
       }

       .section-title::before {
           content: '';
           width: 4px;
           height: 18px;
           background: #667eea;
           margin-right: 10px;
       }

       .form-group {
           margin-bottom: 15px;
       }

       label {
           display: block;
           margin-bottom: 5px;
           font-weight: bold;
           color: #333;
           font-size: 14px;
       }

       input[type="text"], input[type="file"], textarea, select {
           width: 100%;
           padding: 10px;
           border: 2px solid #ddd;
           border-radius: 5px;
           font-size: 14px;
           transition: border-color 0.3s;
       }

       input[type="text"]:focus, textarea:focus, select:focus {
           outline: none;
           border-color: #667eea;
       }

       textarea {
           min-height: 150px;
           font-family: 'Courier New', monospace;
           resize: vertical;
       }

       .btn {
           padding: 12px 30px;
           border: none;
           border-radius: 5px;
           font-size: 16px;
           cursor: pointer;
           transition: all 0.3s;
           margin-right: 10px;
           margin-bottom: 10px;
       }

       .btn-primary {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
       }

       .btn-primary:hover {
           transform: translateY(-2px);
           box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
       }

       .btn-secondary {
           background: #6c757d;
           color: white;
       }

       .btn-secondary:hover {
           background: #5a6268;
       }

       .btn-success {
           background: #28a745;
           color: white;
       }

       .btn-success:hover {
           background: #218838;
       }

       .btn-warning {
           background: #ffc107;
           color: #212529;
       }

       .btn-warning:hover {
           background: #e0a800;
       }

       .result-section {
           background: white;
           padding: 20px;
           border-radius: 10px;
           border: 2px solid #667eea;
           margin-top: 20px;
       }

       .result-stats {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
           gap: 15px;
           margin-bottom: 20px;
       }

       .stat-card {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
           padding: 20px;
           border-radius: 10px;
           text-align: center;
       }

       .stat-card .label {
           font-size: 14px;
           opacity: 0.9;
           margin-bottom: 5px;
       }

       .stat-card .value {
           font-size: 28px;
           font-weight: bold;
       }

       .result-table {
           width: 100%;
           border-collapse: collapse;
           margin-top: 20px;
           font-size: 12px;
       }

       .result-table th, .result-table td {
           padding: 8px;
           text-align: center;
           border: 1px solid #ddd;
       }

       .result-table th {
           background: #667eea;
           color: white;
           font-weight: bold;
           position: sticky;
           top: 0;
           z-index: 10;
       }

       .result-table tr:nth-child(even) {
           background: #f8f9fa;
       }

       .result-table tr:hover {
           background: #e9ecef;
       }

       .hit {
           color: #28a745;
           font-weight: bold;
       }

       .miss {
           color: #dc3545;
       }

       .calc-detail {
           font-size: 11px;
           color: #666;
           text-align: left;
           line-height: 1.4;
       }

       .calc-step {
           background: #f8f9fa;
           padding: 3px 5px;
           margin: 2px 0;
           border-left: 2px solid #667eea;
       }

       .formula-examples {
           background: #fff3cd;
           padding: 15px;
           border-radius: 5px;
           border-left: 4px solid #ffc107;
           margin-top: 10px;
           font-size: 13px;
       }

       .formula-examples h4 {
           margin-bottom: 10px;
           color: #856404;
       }

       .formula-examples code {
           background: white;
           padding: 2px 5px;
           border-radius: 3px;
           color: #d63384;
       }

       .error-message, .success-message {
           padding: 15px;
           border-radius: 5px;
           margin-top: 15px;
       }

       .error-message {
           background: #f8d7da;
           color: #721c24;
           border-left: 4px solid #f5c6cb;
       }

       .success-message {
           background: #d4edda;
           color: #155724;
           border-left: 4px solid #c3e6cb;
       }

       .modal {
           display: none;
           position: fixed;
           z-index: 1000;
           left: 0;
           top: 0;
           width: 100%;
           height: 100%;
           background-color: rgba(0,0,0,0.5);
       }

       .modal-content {
           background-color: white;
           margin: 5% auto;
           padding: 30px;
           border-radius: 10px;
           width: 90%;
           max-width: 900px;
           max-height: 80vh;
           overflow-y: auto;
       }

       .modal-close {
           color: #aaa;
           float: right;
           font-size: 28px;
           font-weight: bold;
           cursor: pointer;
       }

       .modal-close:hover {
           color: #000;
       }

       .batch-result {
           margin-bottom: 20px;
           padding: 15px;
           background: #f8f9fa;
           border-radius: 8px;
           border-left: 4px solid #667eea;
       }

       .batch-result h3 {
           color: #667eea;
           margin-bottom: 10px;
       }

       .period-mode-hint {
           background: #e3f2fd;
           padding: 8px;
           border-radius: 5px;
           margin-top: 8px;
           font-size: 12px;
           color: #1976d2;
           line-height: 1.5;
       }

       .settings-indicator {
           position: fixed;
           bottom: 20px;
           right: 20px;
           background: white;
           padding: 15px;
           border-radius: 10px;
           box-shadow: 0 5px 15px rgba(0,0,0,0.2);
           font-size: 12px;
           max-width: 300px;
           z-index: 99;
       }

       .settings-indicator h4 {
           color: #667eea;
           margin-bottom: 8px;
           font-size: 14px;
       }

       .settings-indicator p {
           margin: 3px 0;
           color: #666;
       }

       .prediction-section {
           background: #fff3cd;
           padding: 20px;
           border-radius: 10px;
           border-left: 4px solid #ffc107;
           margin-top: 20px;
       }

       .prediction-section h3 {
           color: #856404;
           margin-bottom: 15px;
       }

       .statistics-section {
           background: #e3f2fd;
           padding: 20px;
           border-radius: 10px;
           border-left: 4px solid #2196f3;
           margin-top: 20px;
       }

       .statistics-section h3 {
           color: #1976d2;
           margin-bottom: 15px;
       }

       .statistics-grid {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
           gap: 15px;
           margin-top: 20px;
       }
       
       .stat-group {
           background: white;
           padding: 15px;
           border-radius: 8px;
           border: 1px solid #ddd;
       }
       
       .stat-group h4 {
           color: #667eea;
           margin-bottom: 10px;
           font-size: 14px;
       }
       
       .stat-item {
           padding: 5px 0;
           border-bottom: 1px solid #f0f0f0;
           font-family: 'Courier New', monospace;
           font-size: 13px;
       }
       
       .stat-count {
           color: #d32f2f;
           font-weight: bold;
       }
       
       .stat-items {
           color: #1976d2;
       }
       
       .stat-total {
           color: #388e3c;
           font-weight: bold;
       }

       .stat-line {
           padding: 8px;
           margin: 5px 0;
           background: white;
           border-radius: 5px;
           font-family: 'Courier New', monospace;
           font-size: 14px;
           line-height: 1.6;
       }

       @media (max-width: 768px) {
           .menu-bar {
               flex-wrap: wrap;
           }
           
           .menu-item {
               font-size: 12px;
               padding: 10px 12px;
           }

           .menu-dropdown {
               min-width: 280px;
           }

           .main-content {
               padding: 15px;
           }

           .section {
               padding: 15px;
           }

           .result-stats {
               grid-template-columns: 1fr;
           }

           .result-table {
               font-size: 10px;
           }

           .result-table th, .result-table td {
               padding: 5px;
           }
           
           .statistics-grid {
               grid-template-columns: 1fr;
           }
       }
   </style>
</head>
<body>
   <div class="container">
       <div class="header">
           <h1>ğŸ° å…­åˆå½©å…¬å¼éªŒè¯å™¨ - å®Œæ•´ç‰ˆ</h1>
           <p>æ”¯æŒ27ç§å…¬å¼ç±»å‹ | æœŸå·æ¨¡å¼é€‰æ‹© | æ‰¹é‡å…¬å¼éªŒè¯ | è¯¦ç»†è®¡ç®—è¿‡ç¨‹ | å®Œæ•´ç»Ÿè®¡åˆ†æ | ä¸‹æœŸé¢„æµ‹</p>
       </div>

       <!-- èœå•æ  -->
       <div class="menu-bar">
           <!-- æœŸå·è®¾ç½®èœå• -->
           <div class="menu-item">
               <span>ğŸ“…</span>
               <span>æœŸå·è®¾ç½®</span>
               <div class="menu-dropdown">
                   <div class="dropdown-section">
                       <h4>æœŸå·è®¡ç®—æ¨¡å¼</h4>
                       <div class="dropdown-option">
                           <select id="periodMode" onchange="updateSettings()">
                               <option value="current" selected>æ¨¡å¼1ï¼šæœ¬æœŸå·=å½“å‰è®¡ç®—æœŸ</option>
                               <option value="next">æ¨¡å¼2ï¼šæœ¬æœŸå·=ä¸‹æœŸå¼€å¥–æœŸ</option>
                           </select>
                       </div>
                       <div class="period-mode-hint">
                           <strong>æ¨¡å¼1ï¼š</strong>ç”¨2025001æœŸå·ç è®¡ç®—æ—¶ï¼Œæ‰€æœ‰æœŸå·å‚æ•°=2025001<br>
                           <strong>æ¨¡å¼2ï¼š</strong>ç”¨2025001æœŸé¢„æµ‹2025002æœŸæ—¶ï¼Œå‚æ•°=2025002
                       </div>
                   </div>
                   <div class="dropdown-section">
                       <h4>å…¶ä»–é€‰é¡¹</h4>
                       <div class="dropdown-option">
                           <input type="checkbox" id="includeYear" onchange="updateSettings()">
                           <label for="includeYear">æœŸå·è®¡ç®—åŒ…å«å¹´ä»½</label>
                       </div>
                   </div>
               </div>
           </div>

           <!-- ç”Ÿè‚–è®¾ç½®èœå• -->
           <div class="menu-item">
               <span>ğŸ‰</span>
               <span>ç”Ÿè‚–è®¾ç½®</span>
               <div class="menu-dropdown">
                   <div class="dropdown-section">
                       <h4>ç”Ÿè‚–å–å€¼èŒƒå›´ï¼ˆå¹´é¾„ç±»ï¼‰</h4>
                       <div class="dropdown-option">
                           <select id="zodiacRange" onchange="updateSettings()">
                               <option value="0-11">0åˆ°11ï¼ˆå½“å¹´ç”Ÿè‚–=0ï¼‰</option>
                               <option value="1-12" selected>1åˆ°12ï¼ˆå½“å¹´ç”Ÿè‚–=1ï¼‰</option>
                           </select>
                       </div>
                   </div>
                   <div class="dropdown-section">
                       <h4>è‚–ä½å–å€¼èŒƒå›´ï¼ˆæ’ä½ç±»ï¼‰</h4>
                       <div class="dropdown-option">
                           <select id="zodiacPosRange" onchange="updateSettings()">
                               <option value="0-11">0åˆ°11ï¼ˆé¼ =0ï¼‰</option>
                               <option value="1-12" selected>1åˆ°12ï¼ˆé¼ =1ï¼‰</option>
                           </select>
                       </div>
                   </div>
               </div>
           </div>

           <!-- å±æ€§è®¾ç½®èœå• -->
           <div class="menu-item">
               <span>ğŸ¨</span>
               <span>å±æ€§è®¾ç½®</span>
               <div class="menu-dropdown">
                   <div class="dropdown-section">
                       <h4>æ³¢è‰²å–å€¼èŒƒå›´</h4>
                       <div class="dropdown-option">
                           <select id="colorRange" onchange="updateSettings()">
                               <option value="0-2" selected>0åˆ°2ï¼ˆçº¢=0ï¼Œè“=1ï¼Œç»¿=2ï¼‰</option>
                               <option value="1-3">1åˆ°3ï¼ˆçº¢=1ï¼Œè“=2ï¼Œç»¿=3ï¼‰</option>
                           </select>
                       </div>
                   </div>
                   <div class="dropdown-section">
                       <h4>äº”è¡Œå–å€¼èŒƒå›´</h4>
                       <div class="dropdown-option">
                           <select id="elementRange" onchange="updateSettings()">
                               <option value="0-4" selected>0åˆ°4ï¼ˆé‡‘=0ï½åœŸ=4ï¼‰</option>
                               <option value="1-5">1åˆ°5ï¼ˆé‡‘=1ï½åœŸ=5ï¼‰</option>
                           </select>
                       </div>
                       <button class="dropdown-btn" onclick="openElementConfig()">ğŸ”§ é…ç½®äº”è¡Œå·ç </button>
                   </div>
                   <div class="dropdown-section">
                       <h4>æ®µæ•°å–å€¼èŒƒå›´</h4>
                       <div class="dropdown-option">
                           <select id="sectionRange" onchange="updateSettings()">
                               <option value="0-6">0åˆ°6ï¼ˆç¬¬1æ®µ=0ï¼‰</option>
                               <option value="1-7" selected>1åˆ°7ï¼ˆç¬¬1æ®µ=1ï¼‰</option>
                           </select>
                       </div>
                   </div>
               </div>
           </div>

           <!-- æ•°æ®ç®¡ç†èœå• -->
           <div class="menu-item">
               <span>ğŸ“Š</span>
               <span>æ•°æ®ç®¡ç†</span>
               <div class="menu-dropdown">
                   <div class="dropdown-section">
                       <h4>å¿«é€Ÿæ“ä½œ</h4>
                       <button class="dropdown-btn" onclick="document.getElementById('fileInput').click()">ğŸ“‚ å¯¼å…¥TXTæ–‡ä»¶</button>
                       <button class="dropdown-btn" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                   </div>
                   <div class="dropdown-section">
                       <h4>æ˜¾ç¤ºé€‰é¡¹</h4>
                       <div class="dropdown-option">
                           <input type="checkbox" id="reverseOrder">
                           <label for="reverseOrder">å€’åºæ˜¾ç¤ºæ•°æ®</label>
                       </div>
                   </div>
               </div>
           </div>

           <!-- å¸®åŠ©èœå• -->
           <div class="menu-item">
               <span>â“</span>
               <span>å¸®åŠ©</span>
               <div class="menu-dropdown">
                   <div class="dropdown-section">
                       <h4>å¸¸ç”¨å…¬å¼ç¤ºä¾‹</h4>
                       <div style="font-size: 12px; line-height: 1.6; color: #666;">
                           <code>å¹³1è‚–ä½+å¹³åˆ†æ•°=ä¸‹æœŸæ€ä¸€è‚–</code><br>
                           <code>å¹³åˆ†å°¾+æ€»åˆå°¾=ä¸‹æœŸæ€ä¸€å°¾</code><br>
                           <code>å¹³ç ä¸‰+08=ä¸‹æœŸæ€ä¸€è‚–</code>
                       </div>
                   </div>
                   <div class="dropdown-section">
                       <h4>æ‰¹é‡æ ¼å¼è¯´æ˜</h4>
                       <div style="font-size: 12px; line-height: 1.6; color: #666;">
                           æ‰¹é‡éªŒè¯æ—¶ï¼Œç›´æ¥è¾“å…¥å…¬å¼å³å¯ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼Œ<br>
                           ä¼šä½¿ç”¨å½“å‰é€‰æ‹©çš„ç±»å‹ã€ç›®æ ‡å’Œæ€é¡¹è®¾ç½®
                       </div>
                   </div>
               </div>
           </div>
       </div>

       <div class="main-content">
           <!-- æ•°æ®å¯¼å…¥åŒº -->
           <div class="section">
               <div class="section-title">ğŸ“Š å¼€å¥–æ•°æ®å¯¼å…¥</div>
               <input type="file" id="fileInput" accept=".txt" onchange="importFromFile()" style="display: none;">
               <div class="form-group">
                   <label>ç²˜è´´æˆ–ç¼–è¾‘æ•°æ®ï¼ˆæ ¼å¼ï¼šæœŸå· å¹³1 å¹³2 å¹³3 å¹³4 å¹³5 å¹³6 ç‰¹ç ï¼‰</label>
                   <textarea id="dataInput" placeholder="ä¾‹å¦‚ï¼š&#10;2025001 37 34 09 46 16 30 33&#10;2025002 16 27 28 33 12 38 44"></textarea>
               </div>
               <button class="btn btn-primary" onclick="importData()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
               <div id="importMessage"></div>
           </div>

           <!-- å…¬å¼è¾“å…¥åŒº -->
           <div class="section">
               <div class="section-title">âœï¸ å…¬å¼è®¾ç½®</div>
               <div class="form-group">
                   <label>éªŒè¯æ¨¡å¼</label>
                   <select id="verifyMode" onchange="toggleVerifyMode()">
                       <option value="single" selected>å•å…¬å¼éªŒè¯</option>
                       <option value="batch">æ‰¹é‡å…¬å¼éªŒè¯</option>
                   </select>
               </div>

               <!-- å…¬å¼ç±»å‹ã€éªŒè¯ç›®æ ‡ã€æ€é¡¹ç±»å‹ï¼ˆå…±ç”¨ï¼‰ -->
               <div class="form-group">
                   <label>å…¬å¼ç±»å‹</label>
                   <select id="formulaType">
                       <option value="L" selected>Lç±»å…¬å¼ï¼ˆè½çƒåºï¼‰</option>
                       <option value="D">Dç±»å…¬å¼ï¼ˆå¤§å°åºï¼‰</option>
                   </select>
               </div>
               <div class="form-group">
                   <label>éªŒè¯ç›®æ ‡</label>
                   <select id="verifyTarget">
                       <option value="ç‰¹ç " selected>ç‰¹ç </option>
                       <option value="å¹³ç ">å¹³ç ï¼ˆ6ä¸ªå¹³ç ä»»æ„ä¸€ä¸ªï¼‰</option>
                       <option value="å¹³ç‰¹">å¹³ç‰¹ï¼ˆ7ä¸ªå·ç ä»»æ„ä¸€ä¸ªï¼‰</option>
                       <option value="å¹³1ä½">å¹³1ä½</option>
                       <option value="å¹³2ä½">å¹³2ä½</option>
                       <option value="å¹³3ä½">å¹³3ä½</option>
                       <option value="å¹³4ä½">å¹³4ä½</option>
                       <option value="å¹³5ä½">å¹³5ä½</option>
                       <option value="å¹³6ä½">å¹³6ä½</option>
                   </select>
               </div>
               <div class="form-group">
                   <label>æ€é¡¹ç±»å‹</label>
                   <select id="killType">
                       <option value="æ€ä¸€ç ">æ€ä¸€ç </option>
                       <option value="æ€åˆå°¾">æ€åˆå°¾</option>
                       <option value="æ€ä¸€è‚–">æ€ä¸€è‚–</option>
                       <option value="æ€è‚–ä½">æ€è‚–ä½</option>
                       <option value="æ€ä¸€å°¾">æ€ä¸€å°¾</option>
                       <option value="æ€ä¸€æ®µ">æ€ä¸€æ®µ</option>
                       <option value="æ€åŠæ³¢">æ€åŠæ³¢</option>
                       <option value="æ€ä¸€å¤´">æ€ä¸€å¤´</option>
                       <option value="æ€ä¸€è¡Œ">æ€ä¸€è¡Œ</option>
                       <option value="æ€ä¸€é—¨">æ€ä¸€é—¨</option>
                       <option value="æ€å¤§å°åŒ">æ€å¤§å°åŒ</option>
                       <option value="æ€åŠå•åŒ">æ€åŠå•åŒ</option>
                       <option value="æ€ä¸€æ³¢">æ€ä¸€æ³¢</option>
                       <option value="æ€å•åŒ">æ€å•åŒ</option>
                       <option value="æ€å¤§å°">æ€å¤§å°</option>
                       <option value="æ€åˆå¤§å°">æ€åˆå¤§å°</option>
                       <option value="æ€åˆå•åŒ">æ€åˆå•åŒ</option>
                       <option value="æ€å°¾å¤§å°">æ€å°¾å¤§å°</option>
                       <option value="æ€ä¸ƒä½™">æ€ä¸ƒä½™</option>
                       <option value="æ€å…­ä½™">æ€å…­ä½™</option>
                       <option value="æ€äº”ä½™">æ€äº”ä½™</option>
                       <option value="æ€å››ä½™">æ€å››ä½™</option>
                       <option value="æ€ä¸‰ä½™">æ€ä¸‰ä½™</option>
                       <option value="æ€ä¸€åˆ">æ€ä¸€åˆ</option>
                       <option value="æ€åŠå¤´">æ€åŠå¤´</option>
                       <option value="æ€ä¸ƒè‚–">æ€ä¸ƒè‚–</option>
                       <option value="æ€ä¹è‚–">æ€ä¹è‚–</option>
                       <option value="æ€å¹³ç‰¹è‚–">æ€å¹³ç‰¹è‚–</option>
                   </select>
               </div>

               <!-- å•å…¬å¼æ¨¡å¼ -->
               <div id="singleFormulaSection">
                   <div class="form-group">
                       <label>è¾“å…¥å…¬å¼</label>
                       <input type="text" id="formulaInput" placeholder="ä¾‹å¦‚ï¼šå¹³1è‚–ä½+å¹³åˆ†æ•°+æ€»åˆ†åˆ+æœŸæ•°å°¾">
                   </div>
               </div>

               <!-- æ‰¹é‡å…¬å¼æ¨¡å¼ -->
               <div id="batchFormulaSection" style="display: none;">
                   <div class="form-group">
                       <label>æ‰¹é‡è¾“å…¥å…¬å¼ï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œç›´æ¥è¾“å…¥å…¬å¼å³å¯ï¼‰</label>
                       <textarea id="batchFormulaInput" style="min-height: 200px;" placeholder="ç¤ºä¾‹ï¼š&#10;å¹³1è‚–ä½+å¹³åˆ†æ•°&#10;å¹³ç ä¸‰+08&#10;å¹³åˆ†å°¾+æ€»åˆå°¾"></textarea>
                   </div>
                   <div class="formula-examples">
                       <h4>ğŸ’¡ æ‰¹é‡å…¬å¼æ ¼å¼è¯´æ˜ï¼š</h4>
                       <p>ç›´æ¥è¾“å…¥å…¬å¼å³å¯ï¼Œæ¯è¡Œä¸€ä¸ª</p>
                       <p>ä¼šä½¿ç”¨ä¸Šæ–¹é€‰æ‹©çš„ç±»å‹ã€ç›®æ ‡å’Œæ€é¡¹è®¾ç½®</p>
                       <p>ç¤ºä¾‹ï¼š</p>
                       <p><code>å¹³1è‚–ä½+å¹³åˆ†æ•°</code></p>
                       <p><code>å¹³åˆ†å°¾+æ€»åˆå°¾</code></p>
                   </div>
               </div>

               <div class="form-group">
                   <label>éªŒè¯æœŸæ•°èŒƒå›´ï¼ˆå¯é€‰ï¼‰</label>
                   <div style="display: flex; gap: 10px;">
                       <input type="text" id="startPeriod" placeholder="èµ·å§‹æœŸå·" style="flex: 1;">
                       <input type="text" id="endPeriod" placeholder="ç»“æŸæœŸå·" style="flex: 1;">
                   </div>
               </div>

               <button class="btn btn-primary" onclick="calculateFormula()">ğŸ§® å¼€å§‹éªŒè¯</button>
               <button class="btn btn-warning" onclick="calculateLatestUnopened()">ğŸ”® è®¡ç®—æœªå¼€å‡ºç»“æœ</button>
               <button class="btn btn-success" onclick="exportToExcel()">ğŸ“¤ å¯¼å‡ºExcel</button>
           </div>

           <!-- ç»“æœæ˜¾ç¤ºåŒº -->
           <div id="resultSection" style="display: none;">
               <div class="section">
                   <div class="section-title">ğŸ“ˆ éªŒè¯ç»“æœ</div>
                   <div id="batchResultsContainer"></div>
                   <div id="singleResultContainer"></div>
               </div>
           </div>
       </div>
   </div>

   <!-- å½“å‰è®¾ç½®æç¤º -->
   <div class="settings-indicator" id="settingsIndicator">
       <h4>âš™ï¸ å½“å‰è®¾ç½®</h4>
       <p id="settingsPeriodMode"></p>
       <p id="settingsZodiac"></p>
       <p id="settingsColor"></p>
   </div>

   <!-- äº”è¡Œé…ç½®å¼¹çª— -->
   <div id="elementModal" class="modal">
       <div class="modal-content">
           <span class="modal-close" onclick="closeElementConfig()">&times;</span>
           <h2 style="color: #667eea; margin-bottom: 20px;">âš™ï¸ äº”è¡Œå·ç é…ç½®</h2>
           <div class="form-group">
               <label>é€‰æ‹©å¹´ä»½</label>
               <select id="elementYear" onchange="loadElementConfig()">
                   <option value="2025" selected>2025å¹´</option>
                   <option value="2024">2024å¹´</option>
                   <option value="2023">2023å¹´</option>
               </select>
           </div>
           <div style="display: grid; grid-template-columns: 60px 1fr; gap: 10px; align-items: center;">
               <label style="font-weight: bold; color: #667eea;">é‡‘ï¼š</label>
               <input type="text" id="element_jin" placeholder="ç”¨ç©ºæ ¼åˆ†éš”">
               <label style="font-weight: bold; color: #667eea;">æœ¨ï¼š</label>
               <input type="text" id="element_mu" placeholder="ç”¨ç©ºæ ¼åˆ†éš”">
               <label style="font-weight: bold; color: #667eea;">æ°´ï¼š</label>
               <input type="text" id="element_shui" placeholder="ç”¨ç©ºæ ¼åˆ†éš”">
               <label style="font-weight: bold; color: #667eea;">ç«ï¼š</label>
               <input type="text" id="element_huo" placeholder="ç”¨ç©ºæ ¼åˆ†éš”">
               <label style="font-weight: bold; color: #667eea;">åœŸï¼š</label>
               <input type="text" id="element_tu" placeholder="ç”¨ç©ºæ ¼åˆ†éš”">
           </div>
           <div style="margin-top: 20px;">
               <button class="btn btn-primary" onclick="saveElementConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
               <button class="btn btn-secondary" onclick="closeElementConfig()">å–æ¶ˆ</button>
           </div>
       </div>
   </div>

   <script>
       // å…¨å±€å˜é‡
       let lotteryData = [];
       let calculationResults = [];
       let batchResults = [];

       // äº”è¡Œé…ç½®
       let elementConfigs = {
           2025: {
               'é‡‘': [7,8,15,16,23,24,37,38,45,46],
               'æœ¨': [5,6,19,20,27,28,35,36,49],
               'æ°´': [3,4,11,12,25,26,33,34,41,42],
               'ç«': [13,14,21,22,29,30,43,44],
               'åœŸ': [1,2,9,10,17,18,31,32,39,40,47,48]
           }
       };

       // ç”Ÿè‚–æ•°æ®
       const zodiacYearData = {
           2025: { year: 'è›‡', mapping: {
               'è›‡': [1,13,25,37,49], 'é¾™': [2,14,26,38], 'å…”': [3,15,27,39],
               'è™': [4,16,28,40], 'ç‰›': [5,17,29,41], 'é¼ ': [6,18,30,42],
               'çŒª': [7,19,31,43], 'ç‹—': [8,20,32,44], 'é¸¡': [9,21,33,45],
               'çŒ´': [10,22,34,46], 'ç¾Š': [11,23,35,47], 'é©¬': [12,24,36,48]
           }}
       };

       // ç”Ÿè‚–ä½ç½®ï¼ˆå›ºå®šä¸å˜ï¼‰
       const zodiacPosition = {
           'é¼ ': [1,13,25,37,49], 'ç‰›': [2,14,26,38], 'è™': [3,15,27,39],
           'å…”': [4,16,28,40], 'é¾™': [5,17,29,41], 'è›‡': [6,18,30,42],
           'é©¬': [7,19,31,43], 'ç¾Š': [8,20,32,44], 'çŒ´': [9,21,33,45],
           'é¸¡': [10,22,34,46], 'ç‹—': [11,23,35,47], 'çŒª': [12,24,36,48]
       };

       // æ³¢è‰²å±æ€§
       const colorMap = {
           'çº¢': [1,2,7,8,12,13,18,19,23,24,29,30,34,35,40,45,46],
           'è“': [3,4,9,10,14,15,20,25,26,31,36,37,41,42,47,48],
           'ç»¿': [5,6,11,16,17,21,22,27,28,32,33,38,39,43,44,49]
       };

       // åˆå§‹åŒ–è®¾ç½®
       function updateSettings() {
           const periodMode = document.getElementById('periodMode').value;
           const zodiacRange = document.getElementById('zodiacRange').value;
           const colorRange = document.getElementById('colorRange').value;
           
           document.getElementById('settingsPeriodMode').textContent = 
               `æœŸå·æ¨¡å¼ï¼š${periodMode === 'current' ? 'æœ¬æœŸå·=å½“å‰æœŸ' : 'æœ¬æœŸå·=ä¸‹æœŸå·'}`;
           document.getElementById('settingsZodiac').textContent = 
               `ç”Ÿè‚–èŒƒå›´ï¼š${zodiacRange}`;
           document.getElementById('settingsColor').textContent = 
               `æ³¢è‰²èŒƒå›´ï¼š${colorRange}`;
       }

       // åˆ‡æ¢éªŒè¯æ¨¡å¼
       function toggleVerifyMode() {
           const mode = document.getElementById('verifyMode').value;
           if (mode === 'batch') {
               document.getElementById('singleFormulaSection').style.display = 'none';
               document.getElementById('batchFormulaSection').style.display = 'block';
           } else {
               document.getElementById('singleFormulaSection').style.display = 'block';
               document.getElementById('batchFormulaSection').style.display = 'none';
           }
       }

       // ä»æ–‡ä»¶å¯¼å…¥æ•°æ®
       function importFromFile() {
           const file = document.getElementById('fileInput').files[0];
           if (!file) return;
           const reader = new FileReader();
           reader.onload = function(e) {
               document.getElementById('dataInput').value = e.target.result;
               importData();
           };
           reader.readAsText(file, 'UTF-8');
       }

       // å¯¼å…¥æ•°æ®
       function importData() {
           const dataInput = document.getElementById('dataInput').value.trim();
           if (!dataInput) {
               showMessage('importMessage', 'âŒ è¯·è¾“å…¥å¼€å¥–æ•°æ®ï¼', 'error');
               return;
           }

           try {
               lotteryData = [];
               const lines = dataInput.split('\n');
               for (let line of lines) {
                   line = line.trim();
                   if (!line) continue;
                   const parts = line.split(/\s+/);
                   if (parts.length !== 8) throw new Error(`æ•°æ®æ ¼å¼é”™è¯¯ï¼š${line}`);
                   lotteryData.push({
                       period: parts[0],
                       numbers: parts.slice(1, 7).map(n => parseInt(n)),
                       numbersOriginal: parts.slice(1, 7).map(n => parseInt(n)),
                       special: parseInt(parts[7])
                   });
               }
               if (document.getElementById('reverseOrder').checked) {
                   lotteryData.reverse();
               }
               showMessage('importMessage', `âœ… æˆåŠŸå¯¼å…¥ ${lotteryData.length} æœŸæ•°æ®ï¼`, 'success');
           } catch (error) {
               showMessage('importMessage', `âŒ å¯¼å…¥å¤±è´¥ï¼š${error.message}`, 'error');
           }
       }

       // æ¸…ç©ºæ•°æ®
       function clearData() {
           if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) return;
           document.getElementById('dataInput').value = '';
           lotteryData = [];
           calculationResults = [];
           batchResults = [];
           document.getElementById('resultSection').style.display = 'none';
           showMessage('importMessage', 'âœ… æ•°æ®å·²æ¸…ç©ºï¼', 'success');
       }

       // æ‰“å¼€äº”è¡Œé…ç½®
       function openElementConfig() {
           document.getElementById('elementModal').style.display = 'block';
           loadElementConfig();
       }

       // å…³é—­äº”è¡Œé…ç½®
       function closeElementConfig() {
           document.getElementById('elementModal').style.display = 'none';
       }

       // åŠ è½½äº”è¡Œé…ç½®
       function loadElementConfig() {
           const year = document.getElementById('elementYear').value;
           const config = elementConfigs[year];
           if (config) {
               document.getElementById('element_jin').value = config['é‡‘'].map(n => String(n).padStart(2, '0')).join(' ');
               document.getElementById('element_mu').value = config['æœ¨'].map(n => String(n).padStart(2, '0')).join(' ');
               document.getElementById('element_shui').value = config['æ°´'].map(n => String(n).padStart(2, '0')).join(' ');
               document.getElementById('element_huo').value = config['ç«'].map(n => String(n).padStart(2, '0')).join(' ');
               document.getElementById('element_tu').value = config['åœŸ'].map(n => String(n).padStart(2, '0')).join(' ');
           }
       }

       // ä¿å­˜äº”è¡Œé…ç½®
       function saveElementConfig() {
           const year = document.getElementById('elementYear').value;
           try {
               elementConfigs[year] = {
                   'é‡‘': document.getElementById('element_jin').value.trim().split(/\s+/).map(n => parseInt(n)).filter(n => !isNaN(n)),
                   'æœ¨': document.getElementById('element_mu').value.trim().split(/\s+/).map(n => parseInt(n)).filter(n => !isNaN(n)),
                   'æ°´': document.getElementById('element_shui').value.trim().split(/\s+/).map(n => parseInt(n)).filter(n => !isNaN(n)),
                   'ç«': document.getElementById('element_huo').value.trim().split(/\s+/).map(n => parseInt(n)).filter(n => !isNaN(n)),
                   'åœŸ': document.getElementById('element_tu').value.trim().split(/\s+/).map(n => parseInt(n)).filter(n => !isNaN(n))
               };
               alert(`âœ… ${year}å¹´äº”è¡Œé…ç½®å·²ä¿å­˜ï¼`);
               closeElementConfig();
           } catch (error) {
               alert(`âŒ ä¿å­˜å¤±è´¥ï¼š${error.message}`);
           }
       }

       // è®¡ç®—å…¬å¼
       function calculateFormula() {
           if (lotteryData.length === 0) {
               alert('âŒ è¯·å…ˆå¯¼å…¥å¼€å¥–æ•°æ®ï¼');
               return;
           }
           const mode = document.getElementById('verifyMode').value;
           if (mode === 'batch') {
               calculateBatchFormulas();
           } else {
               calculateSingleFormula();
           }
       }

       // è®¡ç®—å•å…¬å¼
       function calculateSingleFormula() {
           const formula = document.getElementById('formulaInput').value.trim();
           if (!formula) {
               alert('âŒ è¯·è¾“å…¥å…¬å¼ï¼');
               return;
           }

           const formulaType = document.getElementById('formulaType').value;
           const verifyTarget = document.getElementById('verifyTarget').value;
           const killType = document.getElementById('killType').value;

           try {
               const fullFormula = `${formula}=ä¸‹æœŸ${killType}`;
               const results = verifyFormula(fullFormula, formulaType, verifyTarget);
               const prediction = predictNextPeriod(fullFormula, formulaType, verifyTarget);
               
               calculationResults = results;
               displaySingleResult(prediction);
           } catch (error) {
               alert(`âŒ è®¡ç®—é”™è¯¯ï¼š${error.message}`);
           }
       }

       // è®¡ç®—æ‰¹é‡å…¬å¼ - ä¿®æ”¹ä¸ºä½¿ç”¨ç»Ÿä¸€è®¾ç½®
       function calculateBatchFormulas() {
           const batchInput = document.getElementById('batchFormulaInput').value.trim();
           if (!batchInput) {
               alert('âŒ è¯·è¾“å…¥æ‰¹é‡å…¬å¼ï¼');
               return;
           }

           try {
               const formulaType = document.getElementById('formulaType').value;
               const verifyTarget = document.getElementById('verifyTarget').value;
               const killType = document.getElementById('killType').value;

               const lines = batchInput.split('\n').filter(line => line.trim());
               batchResults = [];
               let successCount = 0;
               let failCount = 0;

               for (let line of lines) {
                   line = line.trim();
                   if (!line) continue;

                   const fullFormula = `${line}=ä¸‹æœŸ${killType}`;

                   try {
                       const results = verifyFormula(fullFormula, formulaType, verifyTarget);
                       const prediction = predictNextPeriod(fullFormula, formulaType, verifyTarget);
                       
                       batchResults.push({
                           formula: line,
                           formulaType: formulaType,
                           verifyTarget: verifyTarget,
                           killType: killType,
                           results: results,
                           prediction: prediction
                       });
                       successCount++;
                   } catch (error) {
                       console.error(`å…¬å¼è®¡ç®—é”™è¯¯ï¼š${line}`, error);
                       failCount++;
                   }
               }

               if (successCount === 0) {
                   alert(`âŒ æ²¡æœ‰æˆåŠŸéªŒè¯ä»»ä½•å…¬å¼ï¼\nå¤±è´¥ï¼š${failCount}æ¡`);
                   return;
               }

               const batchStatistics = generateBatchStatistics(batchResults);
               displayBatchResults(batchStatistics);
               
               if (failCount > 0) {
                   alert(`âš ï¸ æ‰¹é‡éªŒè¯å®Œæˆï¼\næˆåŠŸï¼š${successCount}æ¡\nå¤±è´¥ï¼š${failCount}æ¡`);
               }
           } catch (error) {
               alert(`âŒ æ‰¹é‡è®¡ç®—é”™è¯¯ï¼š${error.message}`);
               console.error(error);
           }
       }

       // è®¡ç®—æœ€æ–°ä¸€æœŸæœªå¼€å‡ºçš„ç»“æœ
       function calculateLatestUnopened() {
           if (lotteryData.length === 0) {
               alert('âŒ è¯·å…ˆå¯¼å…¥å¼€å¥–æ•°æ®ï¼');
               return;
           }

           const mode = document.getElementById('verifyMode').value;
           if (mode === 'batch') {
               const batchInput = document.getElementById('batchFormulaInput').value.trim();
               if (!batchInput) {
                   alert('âŒ è¯·è¾“å…¥æ‰¹é‡å…¬å¼ï¼');
                   return;
               }

               try {
                   const formulaType = document.getElementById('formulaType').value;
                   const verifyTarget = document.getElementById('verifyTarget').value;
                   const killType = document.getElementById('killType').value;

                   const lines = batchInput.split('\n').filter(line => line.trim());
                   const latestData = lotteryData[lotteryData.length - 1];
                   const unopenedResults = [];

                   for (let line of lines) {
                       line = line.trim();
                       if (!line) continue;

                       let calcNumbers = formulaType === 'D' ? 
                           [...latestData.numbers].sort((a, b) => a - b) : 
                           [...latestData.numbersOriginal];

                       const periodMode = document.getElementById('periodMode').value;
                       const periodToUse = periodMode === 'next' ? 
                           getNextPeriod(latestData.period) : latestData.period;

                       const calcDetails = [];
                       const calcValue = calculateLeftPartWithDetails(line, calcNumbers, latestData.special, periodToUse, calcDetails);
                       
                       const killResult = calculateKillResult(calcValue, killType, getNextPeriod(latestData.period));

                       unopenedResults.push({
                           formula: line,
                           formulaType: formulaType,
                           verifyTarget: verifyTarget,
                           calcValue: calcValue,
                           calcDetails: calcDetails,
                           killResult: killResult,
                           killType: killType
                       });
                   }

                   displayUnopenedResults(unopenedResults);
               } catch (error) {
                   alert(`âŒ è®¡ç®—æœªå¼€å‡ºç»“æœé”™è¯¯ï¼š${error.message}`);
               }
           } else {
               alert('âŒ è¯·åˆ‡æ¢åˆ°æ‰¹é‡éªŒè¯æ¨¡å¼ä½¿ç”¨æ­¤åŠŸèƒ½ï¼');
           }
       }

       // è¾…åŠ©å‡½æ•°ï¼šè·å–ä¸‹ä¸€æœŸæœŸå·
       function getNextPeriod(currentPeriod) {
           const yearPart = currentPeriod.substring(0, 4);
           const numPart = parseInt(currentPeriod.substring(4));
           return yearPart + String(numPart + 1).padStart(3, '0');
       }

       // æ˜¾ç¤ºæœªå¼€å‡ºç»“æœ
       function displayUnopenedResults(results) {
           const container = document.getElementById('batchResultsContainer');
           let html = '<h2 style="color: #667eea; margin-bottom: 20px;">ğŸ”® æœ€æ–°ä¸€æœŸæœªå¼€å‡ºç»“æœç»Ÿè®¡</h2>';
           
           // ç”Ÿæˆç»Ÿè®¡
           const statistics = {};
           const killType = results.length > 0 ? results[0].killType : '';
           
           // æ ¹æ®æ€é¡¹ç±»å‹ç¡®å®šæ‰€æœ‰å¯èƒ½çš„å…ƒç´ 
           const allPossibleItems = getAllPossibleKillItems(killType);
           
           // åˆå§‹åŒ–ç»Ÿè®¡å¯¹è±¡
           if (killType) {
               statistics[killType] = {};
               allPossibleItems.forEach(item => {
                   statistics[killType][item] = 0;
               });
           }
           
           // ç»Ÿè®¡å‡ºç°æ¬¡æ•°
           results.forEach(result => {
               result.killResult.numbers.forEach(num => {
                   // æ ¹æ®æ€é¡¹ç±»å‹æ ¼å¼åŒ–æ˜¾ç¤º
                   let displayItem = formatKillItem(num, result.killType);
                   statistics[result.killType][displayItem]++;
               });
           });

           // æ ¼å¼åŒ–ç»Ÿè®¡ç»“æœ
           html += '<div class="statistics-section">';
           html += '<h3>ğŸ“Š æœªå¼€å‡ºå·ç ç»Ÿè®¡</h3>';
           html += '<div class="statistics-grid">';
           
           for (let [killTypeKey, items] of Object.entries(statistics)) {
               const countData = {};
               
               // æŒ‰å‡ºç°æ¬¡æ•°åˆ†ç»„
               for (let [item, count] of Object.entries(items)) {
                   if (!countData[count]) {
                       countData[count] = [];
                   }
                   countData[count].push(item);
               }
               
               html += `
                   <div class="stat-group">
                       <h4>${killTypeKey}ç»Ÿè®¡ï¼š</h4>
               `;
               
               const counts = Object.keys(countData).map(Number).sort((a, b) => b - a);
               
               counts.forEach(count => {
                   const itemsList = countData[count];
                   if (itemsList.length > 0) {
                       html += `
                           <div class="stat-item">
                               <span class="stat-count">ã€–${count}æ¬¡ã€—</span>ï¼š
                               <span class="stat-items">${itemsList.join(',')}</span>
                               <span class="stat-total">(å…±${itemsList.length}ä¸ª)</span>
                           </div>
                       `;
                   }
               });
               
               html += `</div>`;
           }
           
           html += '</div></div>';
           
           // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
           html += '<div class="prediction-section">';
           html += '<h3>ğŸ“‹ è¯¦ç»†è®¡ç®—ç»“æœ</h3>';
           html += '<table class="result-table">';
           html += `
               <thead>
                   <tr>
                       <th>å…¬å¼</th>
                       <th>è®¡ç®—è¿‡ç¨‹</th>
                       <th>è®¡ç®—å€¼</th>
                       <th>é¢„æµ‹æ€é¡¹</th>
                   </tr>
               </thead>
               <tbody>
           `;
           
           results.forEach(result => {
               const calcDetailHTML = result.calcDetails.join(' + ');
               html += `
                   <tr>
                       <td style="text-align: left; font-size: 12px;">${result.formula}</td>
                       <td style="text-align: left; font-size: 11px;">${calcDetailHTML}</td>
                       <td><strong>${result.calcValue}</strong></td>
                       <td><strong style="color: #d32f2f;">${result.killType}: ${result.killResult.display}</strong></td>
                   </tr>
               `;
           });
           
           html += '</tbody></table></div>';
           
           container.innerHTML = html;
           document.getElementById('singleResultContainer').innerHTML = '';
           document.getElementById('resultSection').style.display = 'block';
           document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
       }

       // è·å–æ‰€æœ‰å¯èƒ½çš„æ€é¡¹å…ƒç´ 
       function getAllPossibleKillItems(killType) {
           const period = lotteryData.length > 0 ? lotteryData[0].period : '2025001';
           const year = parseInt(period.substring(0, 4));
           const zodiacData = zodiacYearData[year] || zodiacYearData[2025];
           
           switch(killType) {
               case 'æ€ä¸€ç ':
                   return Array.from({length: 49}, (_, i) => String(i + 1).padStart(2, '0'));
               case 'æ€ä¸€è‚–':
                   return Object.keys(zodiacData.mapping);
               case 'æ€è‚–ä½':
                   return Object.keys(zodiacPosition);
               case 'æ€ä¸€å°¾':
                   return Array.from({length: 10}, (_, i) => i + 'å°¾');
               case 'æ€ä¸€å¤´':
                   return ['0å¤´', '1å¤´', '2å¤´', '3å¤´', '4å¤´'];
               case 'æ€ä¸€æ®µ':
                   const sectionRange = document.getElementById('sectionRange').value;
                   const maxSection = sectionRange === '0-6' ? 6 : 7;
                   return Array.from({length: maxSection + 1}, (_, i) => {
                       return sectionRange === '0-6' ? i + 'æ®µ' : (i === 0 ? i + 'æ®µ' : i + 'æ®µ');
                   }).filter((_, i) => sectionRange === '0-6' ? true : i > 0);
               case 'æ€ä¸€è¡Œ':
                   return ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
               case 'æ€ä¸€æ³¢':
                   return ['çº¢', 'è“', 'ç»¿'];
               case 'æ€åŠæ³¢':
                   return ['çº¢åŒ', 'çº¢å•', 'è“åŒ', 'è“å•', 'ç»¿åŒ', 'ç»¿å•'];
               case 'æ€å¤§å°åŒ':
               case 'æ€åŠå•åŒ':
                   return ['å°åŒ', 'å°å•', 'å¤§åŒ', 'å¤§å•'];
               case 'æ€å•åŒ':
                   return ['å•', 'åŒ'];
               case 'æ€å¤§å°':
                   return ['å°', 'å¤§'];
               case 'æ€åˆå¤§å°':
                   return ['åˆå°', 'åˆå¤§'];
               case 'æ€åˆå•åŒ':
                   return ['åˆåŒ', 'åˆå•'];
               case 'æ€å°¾å¤§å°':
                   return ['å°¾å°', 'å°¾å¤§'];
               case 'æ€åˆå°¾':
                   return Array.from({length: 10}, (_, i) => i + 'åˆå°¾');
               case 'æ€ä¸€åˆ':
                   return Array.from({length: 13}, (_, i) => String(i + 1).padStart(2, '0') + 'åˆ');
               case 'æ€ä¸€é—¨':
                   return ['1é—¨', '2é—¨', '3é—¨', '4é—¨', '5é—¨'];
               case 'æ€åŠå¤´':
                   return ['0å¤´åŒ', '0å¤´å•', '1å¤´åŒ', '1å¤´å•', '2å¤´åŒ', '2å¤´å•', '3å¤´åŒ', '3å¤´å•', '4å¤´åŒ', '4å¤´å•'];
               case 'æ€ä¸ƒä½™':
                   return Array.from({length: 7}, (_, i) => '7ä½™' + i);
               case 'æ€å…­ä½™':
                   return Array.from({length: 6}, (_, i) => '6ä½™' + i);
               case 'æ€äº”ä½™':
                   return Array.from({length: 5}, (_, i) => '5ä½™' + i);
               case 'æ€å››ä½™':
                   return Array.from({length: 4}, (_, i) => '4ä½™' + i);
               case 'æ€ä¸‰ä½™':
                   return Array.from({length: 3}, (_, i) => '3ä½™' + i);
               default:
                   return [];
           }
       }

       // æ ¼å¼åŒ–æ€é¡¹æ˜¾ç¤º
       function formatKillItem(num, killType) {
           if (killType === 'æ€ä¸€è‚–') {
               return getZodiacNameByNumber(num);
           } else if (killType === 'æ€ä¸€å°¾') {
               return num + 'å°¾';
           } else if (killType === 'æ€ä¸€å¤´') {
               return num + 'å¤´';
           } else if (killType === 'æ€ä¸€æ®µ') {
               return num + 'æ®µ';
           } else if (killType === 'æ€ä¸€é—¨') {
               return num + 'é—¨';
           } else if (killType === 'æ€ä¸€è¡Œ') {
               return getElementNameByNumber(num);
           } else if (killType === 'æ€è‚–ä½') {
               return getZodiacPositionNameByNumber(num);
           } else {
               return String(num).padStart(2, '0');
           }
       }

       // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®æ•°å­—è·å–ç”Ÿè‚–åç§°
       function getZodiacNameByNumber(num) {
           const period = lotteryData.length > 0 ? lotteryData[0].period : '2025001';
           const year = parseInt(period.substring(0, 4));
           const zodiacData = zodiacYearData[year] || zodiacYearData[2025];
           
           for (let [name, numbers] of Object.entries(zodiacData.mapping)) {
               if (numbers.includes(num)) {
                   return name;
               }
           }
           return 'æœªçŸ¥';
       }

       // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®æ•°å­—è·å–ç”Ÿè‚–ä½ç½®åç§°
       function getZodiacPositionNameByNumber(num) {
           for (let [name, numbers] of Object.entries(zodiacPosition)) {
               if (numbers.includes(num)) {
                   return name;
               }
           }
           return 'æœªçŸ¥';
       }

       // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®æ•°å­—è·å–äº”è¡Œåç§°
       function getElementNameByNumber(num) {
           const period = lotteryData.length > 0 ? lotteryData[0].period : '2025001';
           const year = parseInt(period.substring(0, 4));
           const config = elementConfigs[year] || elementConfigs[2025];
           const elements = ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
           
           for (let element of elements) {
               if (config[element].includes(num)) {
                   return element;
               }
           }
           return 'æœªçŸ¥';
       }

       // é¢„æµ‹ä¸‹æœŸ
       function predictNextPeriod(formula, formulaType, verifyTarget) {
           if (lotteryData.length === 0) return null;
           
           const lastData = lotteryData[lotteryData.length - 1];
           const lastPeriod = lastData.period;
           
           const yearPart = lastPeriod.substring(0, 4);
           const numPart = parseInt(lastPeriod.substring(4));
           const nextPeriod = yearPart + String(numPart + 1).padStart(3, '0');
           
           let calcNumbers = formulaType === 'D' ? 
               [...lastData.numbers].sort((a, b) => a - b) : 
               [...lastData.numbersOriginal];

           const periodMode = document.getElementById('periodMode').value;
           const periodToUse = periodMode === 'next' ? nextPeriod : lastPeriod;

           const calcDetails = [];
           const [leftPart, rightPart] = formula.split('=').map(p => p.trim());
           const calcValue = calculateLeftPartWithDetails(leftPart, calcNumbers, lastData.special, periodToUse, calcDetails);
           
           const killType = parseKillType(rightPart);
           const killResult = calculateKillResult(calcValue, killType, nextPeriod);

           return {
               period: nextPeriod,
               calcValue: calcValue,
               calcDetails: calcDetails,
               killResult: killResult,
               killType: killType
           };
       }

       // ç”Ÿæˆæ‰¹é‡ç»Ÿè®¡ - ä¿®å¤ç»Ÿè®¡é€»è¾‘
       function generateBatchStatistics(batchResults) {
           const statistics = {};
           
           // é¦–å…ˆç¡®å®šæ€é¡¹ç±»å‹å¹¶åˆå§‹åŒ–æ‰€æœ‰å¯èƒ½çš„å…ƒç´ 
           if (batchResults.length > 0 && batchResults[0].prediction) {
               const killType = batchResults[0].prediction.killType;
               const allPossibleItems = getAllPossibleKillItems(killType);
               
               statistics[killType] = {};
               // åˆå§‹åŒ–æ‰€æœ‰å¯èƒ½çš„å…ƒç´ ä¸º0
               allPossibleItems.forEach(item => {
                   statistics[killType][item] = 0;
               });
           }

           // ç»Ÿè®¡å®é™…å‡ºç°çš„æ¬¡æ•°
           batchResults.forEach((batch) => {
               if (batch.prediction) {
                   const killType = batch.prediction.killType;
                   const killResult = batch.prediction.killResult;
                   
                   killResult.numbers.forEach(num => {
                       const displayItem = formatKillItem(num, killType);
                       if (statistics[killType]) {
                           statistics[killType][displayItem]++;
                       }
                   });
               }
           });

           // é‡æ–°ç»„ç»‡ç»Ÿè®¡æ•°æ®ï¼ŒæŒ‰æ¬¡æ•°åˆ†ç»„
           const finalStatistics = {};
           
           for (let [killType, items] of Object.entries(statistics)) {
               finalStatistics[killType] = {};
               
               // æŒ‰å‡ºç°æ¬¡æ•°åˆ†ç»„
               for (let [item, count] of Object.entries(items)) {
                   if (!finalStatistics[killType][count]) {
                       finalStatistics[killType][count] = [];
                   }
                   finalStatistics[killType][count].push(item);
               }
           }

           return finalStatistics;
       }

       // æ˜¾ç¤ºæ‰¹é‡ç»“æœ
       function displayBatchResults(batchStatistics) {
           document.getElementById('resultSection').style.display = 'block';
           document.getElementById('singleResultContainer').innerHTML = '';
           
           const container = document.getElementById('batchResultsContainer');
           let html = '<h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“Š æ‰¹é‡éªŒè¯ç»“æœ</h2>';
           
           // æ˜¾ç¤ºé¢„æµ‹ç»“æœ
           if (batchResults.length > 0 && batchResults[0].prediction) {
               html += `
                   <div class="prediction-section">
                       <h3>ğŸ”® é¢„æµ‹ä¸‹æœŸï¼š${batchResults[0].prediction.period}</h3>
                       <table class="result-table" style="margin-top: 10px;">
                           <thead>
                               <tr>
                                   <th>å…¬å¼</th>
                                   <th>è®¡ç®—è¿‡ç¨‹</th>
                                   <th>è®¡ç®—å€¼</th>
                                   <th>é¢„æµ‹æ€é¡¹</th>
                               </tr>
                           </thead>
                           <tbody>
               `;
               
               batchResults.forEach((batch, index) => {
                   if (batch.prediction) {
                       const calcDetailHTML = batch.prediction.calcDetails.join(' + ');
                       html += `
                           <tr>
                               <td style="text-align: left; font-size: 12px;">${batch.formula}</td>
                               <td style="text-align: left; font-size: 11px;">${calcDetailHTML}</td>
                               <td><strong>${batch.prediction.calcValue}</strong></td>
                               <td><strong style="color: #d32f2f;">${batch.prediction.killType}: ${batch.prediction.killResult.display}</strong></td>
                           </tr>
                       `;
                   }
               });
               
               html += `
                           </tbody>
                       </table>
                   </div>
               `;
           }

           // æ˜¾ç¤ºç»Ÿè®¡ç»“æœ
           if (Object.keys(batchStatistics).length > 0) {
               html += '<div class="statistics-section">';
               html += '<h3>ğŸ“ˆ æ‰¹é‡ç»Ÿè®¡ç»“æœ</h3>';
               html += '<div class="statistics-grid">';
               
               for (let [killType, countData] of Object.entries(batchStatistics)) {
                   html += `
                       <div class="stat-group">
                           <h4>${killType}ç»Ÿè®¡ï¼š</h4>
                   `;
                   
                   const counts = Object.keys(countData).map(Number).sort((a, b) => b - a);
                   
                   counts.forEach(count => {
                       const items = countData[count];
                       if (items.length > 0) {
                           html += `
                               <div class="stat-item">
                                   <span class="stat-count">ã€–${count}æ¬¡ã€—</span>ï¼š
                                   <span class="stat-items">${items.join(',')}</span>
                                   <span class="stat-total">(å…±${items.length}ä¸ª)</span>
                               </div>
                           `;
                       }
                   });
                   
                   html += `</div>`;
               }
               
               html += '</div></div>';
           }

           // æ˜¾ç¤ºæ¯ä¸ªå…¬å¼çš„è¯¦ç»†ç»“æœ
           batchResults.forEach((batch, index) => {
               const stats = calculateStats(batch.results);
               html += `
                   <div class="batch-result">
                       <h3>å…¬å¼${index + 1}ï¼š${batch.formula}</h3>
                       <div class="result-stats">
                           ${generateStatsHTML(stats)}
                       </div>
                       <div style="overflow-x: auto; max-height: 400px; margin-top: 15px;">
                           ${generateResultTable(batch.results)}
                       </div>
                   </div>
               `;
           });
           
           container.innerHTML = html;
           document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
       }

       // æ˜¾ç¤ºå•ç»“æœ
       function displaySingleResult(prediction) {
           document.getElementById('resultSection').style.display = 'block';
           document.getElementById('batchResultsContainer').innerHTML = '';
           
           const container = document.getElementById('singleResultContainer');
           const stats = calculateStats(calculationResults);
           
           let html = '';
           
           if (prediction) {
               const calcDetailHTML = prediction.calcDetails.map(d => `<div class="calc-step">${d}</div>`).join('');
               html += `
                   <div class="prediction-section">
                       <h3>ğŸ”® é¢„æµ‹ä¸‹æœŸï¼š${prediction.period}</h3>
                       <div style="background: white; padding: 15px; border-radius:5px; margin-top: 10px;">
                           <p><strong>è®¡ç®—è¿‡ç¨‹ï¼š</strong></p>
                           <div class="calc-detail">${calcDetailHTML}</div>
                           <p style="margin-top: 10px;"><strong>è®¡ç®—å€¼ï¼š</strong><span style="font-size: 18px; color: #667eea; margin-left: 10px;">${prediction.calcValue}</span></p>
                           <p style="margin-top: 10px;"><strong>é¢„æµ‹ç»“æœï¼š</strong><span style="font-size: 18px; color: #d32f2f; margin-left: 10px;">${prediction.killType}: ${prediction.killResult.display}</span></p>
                       </div>
                   </div>
               `;
           }
           
           html += `
               <div class="result-stats">
                   ${generateStatsHTML(stats)}
               </div>
               <div style="overflow-x: auto; max-height: 600px;">
                   ${generateResultTable(calculationResults)}
               </div>
           `;
           
           container.innerHTML = html;
           document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
       }

       // éªŒè¯å…¬å¼
       function verifyFormula(formula, formulaType, verifyTarget) {
           let leftPart, rightPart;
           const parts = formula.split('=');
           if (parts.length !== 2) throw new Error('å…¬å¼æ ¼å¼é”™è¯¯');
           leftPart = parts[0].trim();
           rightPart = parts[1].trim();

           const startPeriod = document.getElementById('startPeriod').value.trim();
           const endPeriod = document.getElementById('endPeriod').value.trim();
           
           let dataToVerify = [...lotteryData];
           if (startPeriod && endPeriod) {
               dataToVerify = dataToVerify.filter(d => d.period >= startPeriod && d.period <= endPeriod);
           }

           if (dataToVerify.length < 2) throw new Error('æ•°æ®ä¸è¶³');

           const results = [];
           const periodMode = document.getElementById('periodMode').value;

           for (let i = 0; i < dataToVerify.length - 1; i++) {
               const currentData = dataToVerify[i];
               const nextData = dataToVerify[i + 1];
               
               let calcNumbers = formulaType === 'D' ? 
                   [...currentData.numbers].sort((a,b) => a - b) : 
                   [...currentData.numbersOriginal];

               const periodToUse = periodMode === 'next' ? nextData.period : currentData.period;

               const calcDetails = [];
               const calcValue = calculateLeftPartWithDetails(leftPart, calcNumbers, currentData.special, periodToUse, calcDetails);
               
               const killType = parseKillType(rightPart);
               const killResult = calculateKillResult(calcValue, killType, nextData.period);
               
               const isKillAppeared = verifyKillAppeared(killResult, killType, nextData, verifyTarget);
               const isHit = !isKillAppeared;

               results.push({
                   period: nextData.period,
                   numbers: nextData.numbers,
                   special: nextData.special,
                   verifyTarget: verifyTarget,
                   calcValue: calcValue,
                   calcDetails: calcDetails,
                   killResult: killResult,
                   killType: killType,
                   isHit: isHit,
                   periodUsed: periodToUse
               });
           }

           return results;
       }

       // è®¡ç®—å·¦ä¾§éƒ¨åˆ†ï¼ˆå¸¦è¯¦æƒ…ï¼‰
       function calculateLeftPartWithDetails(leftPart, numbers, special, period, details) {
           const parts = leftPart.split('+').map(p => p.trim());
           let total = 0;

           for (let part of parts) {
               if (/^\d+$/.test(part)) {
                   const value = parseInt(part);
                   total += value;
                   details.push(`${part} = ${value}`);
                   continue;
               }

               const value = parseParameterWithDetails(part, numbers, special, period, details);
               total += value;
           }

           return total;
       }

       // è§£æå‚æ•°ï¼ˆå¸¦è¯¦æƒ…ï¼‰ - ä¿æŒåŸæœ‰é€»è¾‘
       function parseParameterWithDetails(param, numbers, special, period, details) {
           param = param.trim();
           const numMap = {'ä¸€':0, 'äºŒ':1, 'ä¸‰':2, 'å››':3, 'äº”':4, 'å…­':5, '1':0, '2':1, '3':2, '4':3, '5':4, '6':5};
           
           for (let [name, index] of Object.entries(numMap)) {
               const patterns = [`å¹³ç ${name}ç `, `å¹³ç ${name}`, `å¹³${name}`];
               for (let pattern of patterns) {
                   if (param.startsWith(pattern)) {
                       const num = numbers[index];
                       const suffix = param.substring(pattern.length);
                       let value = num;
                       let desc = `å¹³${name}ç (${String(num).padStart(2,'0')})`;
                       
                       const suffixHandlers = [
                           { suffix: 'æ®µ', handler: () => {
                               value = getSectionValue(num);
                               desc += `æ®µ = ${value}`;
                           }},
                           { suffix: 'è¡Œ', handler: () => {
                               value = getElementValue(num, period);
                               const elements = ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
                               const range = document.getElementById('elementRange').value;
                               const baseValue = range === '0-4' ? 0 : 1;
                               desc += `è¡Œ(${elements[value - baseValue]}) = ${value}`;
                           }},
                           { suffix: 'å¤§å°', handler: () => {
                               value = num >= 25 ? 1 : 0;
                               desc += `å¤§å°(${value === 1 ? 'å¤§' : 'å°'}) = ${value}`;
                           }},
                           { suffix: 'åŠæ³¢', handler: () => {
                               value = getHalfColorValue(num);
                               const halfColors = ['çº¢åŒ', 'çº¢å•', 'è“åŒ', 'è“å•', 'ç»¿åŒ', 'ç»¿å•'];
                               desc += `åŠæ³¢(${halfColors[value]}) = ${value}`;
                           }},
                           { suffix: 'å¤§å°åŒ', handler: () => {
                               value = getBigSmallOddEven(num);
                               const dxd = ['å°åŒ', 'å°å•', 'å¤§åŒ', 'å¤§å•'];
                               desc += `å¤§å°åŒ(${dxd[value]}) = ${value}`;
                           }},
                           { suffix: 'åˆå•', handler: () => {
                               const he = Math.floor(num / 10) + (num % 10);
                               value = he % 2;
                               desc += `åˆå•(${num}â†’${he}=${value === 1 ? 'å•' : 'åŒ'}) = ${value}`;
                           }},
                           { suffix: 'åŠå¤´', handler: () => {
                               value = getHalfHeadValue(num);
                               const head = Math.floor(num / 10);
                               const tailParity = (num % 10) % 2 === 1 ? 'å•' : 'åŒ';
                               desc += `åŠå¤´(${head}å¤´${tailParity}) = ${value}`;
                           }},
                           { suffix: 'é—¨', handler: () => {
                               value = getMenValue(num);
                               desc += `é—¨ = ${value}é—¨`;
                           }},
                           { suffix: 'è‚–ä½', handler: () => {
                               value = getZodiacPositionValue(num);
                               const range = document.getElementById('zodiacPosRange').value;
                               const baseValue = range === '0-11' ? 0 : 1;
                               const zodiacNames = Object.keys(zodiacPosition);
                               const zodiacName = zodiacNames[(value - baseValue) % 12];
                               desc += `è‚–ä½(${zodiacName}) = ${value}`;
                           }},
                           { suffix: 'åŠå•åŒ', handler: () => {
                               value = getBigSmallOddEven(num);
                               const dxd = ['å°åŒ', 'å°å•', 'å¤§åŒ', 'å¤§å•'];
                               desc += `åŠå•åŒ(${dxd[value]}) = ${value}`;
                           }},
                           { suffix: 'åŠå•', handler: () => {
                               value = getBigSmallOddEven(num);
                               const dxd = ['å°åŒ', 'å°å•', 'å¤§åŒ', 'å¤§å•'];
                               desc += `åŠå•(${dxd[value]}) = ${value}`;
                           }},
                           { suffix: 'åˆå°¾', handler: () => {
                               const he = Math.floor(num / 10) + (num % 10);
                               value = he % 10;
                               desc += `åˆå°¾(${num}â†’${he}) = ${value}`;
                           }},
                           { suffix: 'å¤´', handler: () => {
                               value = Math.floor(num / 10);
                               desc += `å¤´ = ${value}`;
                           }},
                           { suffix: 'å°¾', handler: () => {
                               value = num % 10;
                               desc += `å°¾ = ${value}`;
                           }},
                           { suffix: 'åˆ', handler: () => {
                               value = Math.floor(num / 10) + (num % 10);
                               desc += `åˆ(${Math.floor(num/10)}+${num%10}) = ${value}`;
                           }},
                           { suffix: 'æ³¢', handler: () => {
                               value = getColorValue(num);
                               const range = document.getElementById('colorRange').value;
                               const baseValue = range === '0-2' ? 0 : 1;
                               const colorNames = ['çº¢', 'è“', 'ç»¿'];
                               desc += `æ³¢(${colorNames[value - baseValue]}) = ${value}`;
                           }},
                           { suffix: 'è‚–', handler: () => {
                               value = getZodiacAge(num, period);
                               desc += `è‚– = ${value}`;
                           }}
                       ];
                       
                       suffixHandlers.sort((a, b) => b.suffix.length - a.suffix.length);
                       
                       let matched = false;
                       for (let handler of suffixHandlers) {
                           if (suffix === handler.suffix) {
                               handler.handler();
                               matched = true;
                               break;
                           }
                       }
                       
                       if (!matched && suffix === '') {
                           desc = `å¹³${name}ç  = ${value}`;
                       }
                       
                       details.push(desc);
                       return value;
                   }
               }
           }

           const heWeiMatch = param.match(/^([1-6ä¸€äºŒä¸‰å››äº”å…­])åˆå°¾$/);
           if (heWeiMatch) {
               const indexMap = {'1':0, '2':1, '3':2, '4':3, '5':4, '6':5, 'ä¸€':0, 'äºŒ':1, 'ä¸‰':2, 'å››':3, 'äº”':4, 'å…­':5};
               const index = indexMap[heWeiMatch[1]];
               const num = numbers[index];
               const he = Math.floor(num / 10) + (num % 10);
               const value = he % 10;
               details.push(`${heWeiMatch[1]}åˆå°¾(å¹³${index+1}=${num}â†’${he}) = ${value}`);
               return value;
           }

           const wuxingMatch = param.match(/^([1-6ä¸€äºŒä¸‰å››äº”å…­])äº”è¡Œ$/);
           if (wuxingMatch) {
               const indexMap = {'1':0, '2':1, '3':2, '4':3, '5':4, '6':5, 'ä¸€':0, 'äºŒ':1, 'ä¸‰':2, 'å››':3, 'äº”':4, 'å…­':5};
               const index = indexMap[wuxingMatch[1]];
               const num = numbers[index];
               const value = getElementValue(num, period);
               const elements = ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
               const range = document.getElementById('elementRange').value;
               const baseValue = range === '0-4' ? 0 : 1;
               details.push(`${wuxingMatch[1]}äº”è¡Œ(å¹³${index+1}=${num}=${elements[value - baseValue]}) = ${value}`);
               return value;
           }

           if (param.startsWith('ç‰¹ç ') || param.startsWith('ç‰¹')) {
               const suffix = param.replace('ç‰¹ç ', '').replace('ç‰¹', '');
               let value = special;
               let desc = `ç‰¹ç (${String(special).padStart(2,'0')})`;
               
               const specialHandlers = [
                   { suffix: 'æ®µ', handler: () => {
                       value = getSectionValue(special);
                       desc += `æ®µ = ${value}`;
                   }},
                   { suffix: 'è¡Œ', handler: () => {
                       value = getElementValue(special, period);
                       const elements = ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
                       const range = document.getElementById('elementRange').value;
                       const baseValue = range === '0-4' ? 0 : 1;
                       desc += `è¡Œ(${elements[value - baseValue]}) = ${value}`;
                   }},
                   { suffix: 'è‚–ä½', handler: () => {
                       value = getZodiacPositionValue(special);
                       const range = document.getElementById('zodiacPosRange').value;
                       const baseValue = range === '0-11' ? 0 : 1;
                       const zodiacNames = Object.keys(zodiacPosition);
                       const zodiacName = zodiacNames[(value - baseValue) % 12];
                       desc += `è‚–ä½(${zodiacName}) = ${value}`;
                   }},
                   { suffix: 'æ³¢', handler: () => {
                       value = getColorValue(special);
                       const range = document.getElementById('colorRange').value;
                       const baseValue = range === '0-2' ? 0 : 1;
                       const colorNames = ['çº¢', 'è“', 'ç»¿'];
                       desc += `æ³¢(${colorNames[value - baseValue]}) = ${value}`;
                   }},
                   { suffix: 'è‚–', handler: () => {
                       value = getZodiacAge(special, period);
                       desc += `è‚– = ${value}`;
                   }},
                   { suffix: 'åˆå•', handler: () => {
                       const he = Math.floor(special / 10) + (special % 10);
                       value = he % 2;
                       desc += `åˆå•(${special}â†’${he}=${value === 1 ? 'å•' : 'åŒ'}) = ${value}`;
                   }},
                   { suffix: 'å¤§å°', handler: () => {
                       value = special >= 25 ? 1 : 0;
                       desc += `å¤§å°(${value === 1 ? 'å¤§' : 'å°'}) = ${value}`;
                   }},
                   { suffix: 'åŠå•', handler: () => {
                       value = getBigSmallOddEven(special);
                       const dxd = ['å°åŒ', 'å°å•', 'å¤§åŒ', 'å¤§å•'];
                       desc += `åŠå•åŒ(${dxd[value]}) = ${value}`;
                   }},
                   { suffix: 'å¤§å°åŒ', handler: () => {
                       value = getBigSmallOddEven(special);
                       const dxd = ['å°åŒ', 'å°å•', 'å¤§åŒ', 'å¤§å•'];
                       desc += `å¤§å°åŒ(${dxd[value]}) = ${value}`;
                   }},
                   { suffix: 'åŠå•åŒ', handler: () => {
                       value = getBigSmallOddEven(special);
                       const dxd = ['å°åŒ', 'å°å•', 'å¤§åŒ', 'å¤§å•'];
                       desc += `åŠå•åŒ(${dxd[value]}) = ${value}`;
                   }},
                   { suffix: 'åŠå¤´', handler: () => {
                       value = getHalfHeadValue(special);
                       const head = Math.floor(special / 10);
                       const tailParity = (special % 10) % 2 === 1 ? 'å•' : 'åŒ';
                       desc += `åŠå¤´(${head}å¤´${tailParity}) = ${value}`;
                   }},
                   { suffix: 'åŠæ³¢', handler: () => {
                       value = getHalfColorValue(special);
                       const halfColors = ['çº¢åŒ', 'çº¢å•', 'è“åŒ', 'è“å•', 'ç»¿åŒ', 'ç»¿å•'];
                       desc += `åŠæ³¢(${halfColors[value]}) = ${value}`;
                   }},
                   { suffix: 'å¤´', handler: () => {
                       value = Math.floor(special / 10);
                       desc += `å¤´ = ${value}`;
                   }},
                   { suffix: 'å°¾', handler: () => {
                       value = special % 10;
                       desc += `å°¾ = ${value}`;
                   }},
                   { suffix: 'åˆ', handler: () => {
                       value = Math.floor(special / 10) + (special % 10);
                       desc += `åˆ = ${value}`;
                   }},
                   { suffix: 'åˆå°¾', handler: () => {
                       const he = Math.floor(special / 10) + (special % 10);
                       value = he % 10;
                       desc += `åˆå°¾ = ${value}`;
                   }},
                   { suffix: 'é—¨', handler: () => {
                       value = getMenValue(special);
                       desc += `é—¨ = ${value}é—¨`;
                   }}
               ];
               
               specialHandlers.sort((a, b) => b.suffix.length - a.suffix.length);
               
               let matched = false;
               for (let handler of specialHandlers) {
                   if (suffix === handler.suffix) {
                       handler.handler();
                       matched = true;
                       break;
                   }
               }
               
               if (!matched && suffix === '') {
                   desc = `ç‰¹ç  = ${value}`;
               }
               
               details.push(desc);
               return value;
           }

           const pingTotal = numbers.reduce((a, b) => a + b, 0);
           
           if (param === 'å¹³åˆ†æ•°') {
               details.push(`å¹³åˆ†æ•°(${numbers.map(n => String(n).padStart(2,'0')).join('+')}) = ${pingTotal}`);
               return pingTotal;
           }
           if (param === 'å¹³åˆ†å°¾') {
               const value = pingTotal % 10;
               details.push(`å¹³åˆ†å°¾(${pingTotal}) = ${value}`);
               return value;
           }
           if (param === 'å¹³åˆ†åˆ') {
               const value = String(pingTotal).split('').reduce((a, b) => a + parseInt(b), 0);
               details.push(`å¹³åˆ†åˆ(${pingTotal}â†’${String(pingTotal).split('').join('+')}) = ${value}`);
               return value;
           }
           if (param === 'å¹³åˆå°¾') {
               const pingHe = String(pingTotal).split('').reduce((a, b) => a + parseInt(b), 0);
               const value = pingHe % 10;
               details.push(`å¹³åˆå°¾(${pingTotal}â†’${pingHe}) = ${value}`);
               return value;
           }

           const total = pingTotal + special;
           
           if (param === 'æ€»åˆ†æ•°') {
               details.push(`æ€»åˆ†æ•°(å¹³åˆ†${pingTotal}+ç‰¹${special}) = ${total}`);
               return total;
           }
           if (param === 'æ€»åˆ†å°¾') {
               const value = total % 10;
               details.push(`æ€»åˆ†å°¾(${total}) = ${value}`);
               return value;
           }
           if (param === 'æ€»åˆ†åˆ') {
               const value = String(total).split('').reduce((a, b) => a + parseInt(b), 0);
               details.push(`æ€»åˆ†åˆ(${total}â†’${String(total).split('').join('+')}) = ${value}`);
               return value;
           }
           if (param === 'æ€»åˆå°¾') {
               const totalHe = String(total).split('').reduce((a, b) => a + parseInt(b), 0);
               const value = totalHe % 10;
               details.push(`æ€»åˆå°¾(${total}â†’${totalHe}) = ${value}`);
               return value;
           }

           const includeYear = document.getElementById('includeYear').checked;
           let periodNum = includeYear ? parseInt(period) : parseInt(period.slice(-3));

           if (param === 'æ€»æœŸæ•°' || param === 'æœ¬æœŸæ•°' || param === 'æœ¬æœŸå·' || param === 'æœŸå·') {
               details.push(`æ€»æœŸæ•°[${period}] = ${periodNum}`);
               return periodNum;
           }
           if (param === 'å¹´æœŸæ•°' || param === 'å¹´æœŸå·') {
               const yearPeriod = parseInt(period.slice(-3));
               details.push(`å¹´æœŸæ•° = ${yearPeriod}`);
               return yearPeriod;
           }
           if (param === 'æœŸæ•°å°¾' || param === 'æœŸå°¾') {
               const value = periodNum % 10;
               details.push(`æœŸæ•°å°¾[${period}] = ${value}`);
               return value;
           }
           if (param === 'æœŸæ•°åˆ' || param === 'æœŸåˆ') {
               const value = String(periodNum).split('').reduce((a, b) => a + parseInt(b), 0);
               details.push(`æœŸæ•°åˆ[${period}] = ${value}`);
               return value;
           }
           if (param === 'æœŸåˆå°¾') {
               const periodHe = String(periodNum).split('').reduce((a, b) => a + parseInt(b), 0);
               const value = periodHe % 10;
               details.push(`æœŸåˆå°¾[${period}] = ${value}`);
               return value;
           }

           if (param.includes('ä¸ŠæœŸ')) {
               const currentIndex = lotteryData.findIndex(d => d.period === period);
               let prevPeriodNum = 0;
               
               if (currentIndex > 0) {
                   const prevPeriod = lotteryData[currentIndex - 1].period;
                   prevPeriodNum = includeYear ? parseInt(prevPeriod) : parseInt(prevPeriod.slice(-3));
               } else {
                   prevPeriodNum = includeYear ? parseInt(period) - 1 : parseInt(period.slice(-3)) - 1;
               }
               
               if (param === 'ä¸ŠæœŸæ•°' || param === 'ä¸ŠæœŸå·') {
                   details.push(`ä¸ŠæœŸæ•° = ${prevPeriodNum}`);
                   return prevPeriodNum;
               }
               if (param === 'ä¸ŠæœŸå°¾') {
                   const value = prevPeriodNum % 10;
                   details.push(`ä¸ŠæœŸå°¾ = ${value}`);
                   return value;
               }
               if (param === 'ä¸ŠæœŸåˆ') {
                   const value = String(prevPeriodNum).split('').reduce((a, b) => a + parseInt(b), 0);
                   details.push(`ä¸ŠæœŸåˆ = ${value}`);
                   return value;
               }
           }

           details.push(`${param} = 0 (æœªè¯†åˆ«)`);
           return 0;
       }

       // è·å–ç”Ÿè‚–ä½ç½®å€¼
       function getZodiacPositionValue(num) {
           const range = document.getElementById('zodiacPosRange').value;
           const baseValue = range === '0-11' ? 0 : 1;
           
           for (let [name, nums] of Object.entries(zodiacPosition)) {
               if (nums.includes(num)) {
                   const zodiacNames = Object.keys(zodiacPosition);
                   const index = zodiacNames.indexOf(name);
                   return baseValue + index;
               }
           }
           return baseValue;
       }

       // è·å–æ³¢è‰²å€¼
       function getColorValue(num) {
           const range = document.getElementById('colorRange').value;
           const baseValue = range === '0-2' ? 0 : 1;
           for (let [color, nums] of Object.entries(colorMap)) {
               if (nums.includes(num)) {
                   if (color === 'çº¢') return baseValue + 0;
                   if (color === 'è“') return baseValue + 1;
                   if (color === 'ç»¿') return baseValue + 2;
               }
           }
           return baseValue;
       }

       // è·å–ç”Ÿè‚–å¹´é¾„å€¼
       function getZodiacAge(num, period) {
           const year = parseInt(period.substring(0, 4));
           const zodiac = zodiacYearData[year] || zodiacYearData[2025];
           const range = document.getElementById('zodiacRange').value;
           const baseValue = range === '0-11' ? 0 : 1;
           for (let [name, nums] of Object.entries(zodiac.mapping)) {
               if (nums.includes(num)) {
                   const zodiacNames = Object.keys(zodiac.mapping);
                   return baseValue + zodiacNames.indexOf(name);
               }
           }
           return baseValue;
       }

       // è·å–æ®µæ•°å€¼
       function getSectionValue(num) {
           const range = document.getElementById('sectionRange').value;
           const baseValue = range === '0-6' ? 0 : 1;
           return baseValue + Math.floor((num - 1) / 7);
       }

       // è·å–äº”è¡Œå€¼
       function getElementValue(num, period) {
           const year = parseInt(period.substring(0, 4));
           const config = elementConfigs[year] || elementConfigs[2025];
           const range = document.getElementById('elementRange').value;
           const baseValue = range === '0-4' ? 0 : 1;
           
           const elements = ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
           for (let i = 0; i < elements.length; i++) {
               if (config[elements[i]].includes(num)) {
                   return baseValue + i;
               }
           }
           return baseValue;
       }

       // è·å–é—¨æ•°å€¼
       function getMenValue(num) {
           return Math.ceil(num / 10);
       }

       // è·å–åŠæ³¢å€¼
       function getHalfColorValue(num) {
           const isOdd = num % 2 === 1;
           for (let [color, nums] of Object.entries(colorMap)) {
               if (nums.includes(num)) {
                   if (color === 'çº¢') return isOdd ? 1 : 0;
                   if (color === 'è“') return isOdd ? 3 : 2;
                   if (color === 'ç»¿') return isOdd ? 5 : 4;
               }
           }
           return 0;
       }

       // è·å–å¤§å°å•åŒå€¼
       function getBigSmallOddEven(num) {
           const isBig = num >= 25;
           const isOdd = num % 2 === 1;
           if (!isBig && !isOdd) return 0;
           if (!isBig && isOdd) return 1;
           if (isBig && !isOdd) return 2;
           return 3;
       }

       // è·å–åŠå¤´å€¼
       function getHalfHeadValue(num) {
           const head = Math.floor(num / 10);
           const tailIsOdd = (num % 10) % 2 === 1;
           return head * 2 + (tailIsOdd ? 1 : 0);
       }

       // è§£ææ€é¡¹ç±»å‹
       function parseKillType(rightPart) {
           rightPart = rightPart.replace(/ä¸‹æœŸ|æ€|ä¸­/g, '').trim();
           
           const killTypeMap = {
               'ä¸€ç ': 'æ€ä¸€ç ',
               'åˆå°¾': 'æ€åˆå°¾',
               'ä¸€è‚–': 'æ€ä¸€è‚–',
               'è‚–ä½': 'æ€è‚–ä½',
               'ä¸€å°¾': 'æ€ä¸€å°¾',
               'ä¸€æ®µ': 'æ€ä¸€æ®µ',
               'åŠæ³¢': 'æ€åŠæ³¢',
               'ä¸€å¤´': 'æ€ä¸€å¤´',
               'ä¸€è¡Œ': 'æ€ä¸€è¡Œ',
               'ä¸€é—¨': 'æ€ä¸€é—¨',
               'å¤§å°åŒ': 'æ€å¤§å°åŒ',
               'åŠå•åŒ': 'æ€åŠå•åŒ',
               'ä¸€æ³¢': 'æ€ä¸€æ³¢',
               'å•åŒ': 'æ€å•åŒ',
               'å¤§å°': 'æ€å¤§å°',
               'åˆå¤§å°': 'æ€åˆå¤§å°',
               'åˆå•åŒ': 'æ€åˆå•åŒ',
               'å°¾å¤§å°': 'æ€å°¾å¤§å°',
               'ä¸ƒä½™': 'æ€ä¸ƒä½™',
               'å…­ä½™': 'æ€å…­ä½™',
               'äº”ä½™': 'æ€äº”ä½™',
               'å››ä½™': 'æ€å››ä½™',
               'ä¸‰ä½™': 'æ€ä¸‰ä½™',
               'ä¸€åˆ': 'æ€ä¸€åˆ',
               'åŠå¤´': 'æ€åŠå¤´',
               'ä¸ƒè‚–': 'æ€ä¸ƒè‚–',
               'ä¹è‚–': 'æ€ä¹è‚–',
               'å¹³ç‰¹è‚–': 'æ€å¹³ç‰¹è‚–'
           };
           
           for (let [key, value] of Object.entries(killTypeMap)) {
               if (rightPart.includes(key)) {
                   return value;
               }
           }
           
           return 'æ€ä¸€ç ';
       }

       // è®¡ç®—æ€é¡¹ç»“æœ - ä¿æŒåŸæœ‰é€»è¾‘
       function calculateKillResult(calcValue, killType, period) {
           const result = {};
           
           switch(killType) {
               case 'æ€ä¸€ç ':
                   let maValue = calcValue % 49;
                   if (maValue === 0) maValue = 49;
                   result.display = String(maValue).padStart(2, '0');
                   result.numbers = [maValue];
                   break;
                   
               case 'æ€åˆå°¾':
                   const heweiValue = calcValue % 10;
                   result.display = heweiValue + 'åˆå°¾';
                   result.numbers = getNumbersByHeWei(heweiValue);
                   break;
                   
               case 'æ€ä¸€è‚–':
                   let zodiacValue = calcValue % 12;
                   const zodiacRange = document.getElementById('zodiacRange').value;
                   if (zodiacRange === '1-12' && zodiacValue === 0) zodiacValue = 12;
                   const year = parseInt(period.substring(0, 4));
                   const zodiacData = zodiacYearData[year] || zodiacYearData[2025];
                   const zodiacNames = Object.keys(zodiacData.mapping);
                   const zodiacIndex = zodiacRange === '0-11' ? zodiacValue : zodiacValue - 1;
                   result.display = zodiacNames[zodiacIndex];
                   result.numbers = zodiacData.mapping[result.display];
                   break;
                   
               case 'æ€è‚–ä½':
                   let xiaoweiValue = calcValue % 12;
                   const zodiacPosRange = document.getElementById('zodiacPosRange').value;
                   if (zodiacPosRange === '1-12' && xiaoweiValue === 0) xiaoweiValue = 12;
                   const zodiacPosNames = Object.keys(zodiacPosition);
                   const zodiacPosIndex = zodiacPosRange === '0-11' ? xiaoweiValue : xiaoweiValue - 1;
                   result.display = zodiacPosNames[zodiacPosIndex];
                   result.numbers = zodiacPosition[result.display];
                   break;
                   
               case 'æ€ä¸€å°¾':
                   const weiValue = calcValue % 10;
                   result.display = weiValue + 'å°¾';
                   result.numbers = [];
                   for (let i = weiValue; i <= 49; i += 10) {
                       if (i > 0) result.numbers.push(i);
                   }
                   break;
                   
               case 'æ€ä¸€æ®µ':
                   let duanValue = calcValue % 7;
                   const sectionRange = document.getElementById('sectionRange').value;
                   if (sectionRange === '1-7' && duanValue === 0) duanValue = 7;
                   else if (sectionRange === '0-6') {
                       duanValue = duanValue;
                   }
                   result.display = duanValue + 'æ®µ';
                   result.numbers = getNumbersBySection(duanValue, sectionRange);
                   break;
                   
               case 'æ€åŠæ³¢':
                   const banboValue = calcValue % 6;
                   result.display = getHalfColorName(banboValue);
                   result.numbers = getNumbersByHalfColor(banboValue);
                   break;
                   
               case 'æ€ä¸€å¤´':
                   let touValue = calcValue % 5;
                   if (touValue === 0) touValue = 4;
                   else touValue = touValue - 1;
                   result.display = touValue + 'å¤´';
                   result.numbers = [];
                   for (let i = touValue * 10 + 1; i <= touValue * 10 + 10 && i <= 49; i++) {
                       result.numbers.push(i);
                   }
                   break;
                   
               case 'æ€ä¸€è¡Œ':
                   let wuxingValue = calcValue % 5;
                   const elementRange = document.getElementById('elementRange').value;
                   if (elementRange === '1-5' && wuxingValue === 0) wuxingValue = 5;
                   const elements = ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
                   const baseValue = elementRange === '0-4' ? 0 : 1;
                   result.display = elements[wuxingValue - baseValue];
                   result.numbers = getNumbersByElement(result.display, period);
                   break;
                   
               case 'æ€ä¸€é—¨':
                   let menValue = calcValue % 5;
                   if (menValue === 0) menValue = 4;
                   else menValue = menValue - 1;
                   result.display = (menValue + 1) + 'é—¨';
                   result.numbers = [];
                   for (let i = menValue * 10 + 1; i <= menValue * 10 + 10 && i <= 49; i++) {
                       result.numbers.push(i);
                   }
                   break;
                   
               case 'æ€å¤§å°åŒ':
               case 'æ€åŠå•åŒ':
                   const dxdValue = calcValue % 4;
                   result.display = getBigSmallOddEvenName(dxdValue);
                   result.numbers = getNumbersByBigSmallOddEven(dxdValue);
                   break;
                   
               case 'æ€ä¸€æ³¢':
                   let boValue = calcValue % 3;
                   const colorRange = document.getElementById('colorRange').value;
                   if (colorRange === '1-3' && boValue === 0) boValue = 3;
                   const colors = ['çº¢', 'è“', 'ç»¿'];
                   const colorBase = colorRange === '0-2' ? 0 : 1;
                   result.display = colors[boValue - colorBase];
                   result.numbers = colorMap[result.display];
                   break;
                   
               case 'æ€å•åŒ':
                   const dsValue = calcValue % 2;
                   result.display = dsValue === 0 ? 'åŒ' : 'å•';
                   result.numbers = getNumbersByOddEven(dsValue);
                   break;
                   
               case 'æ€å¤§å°':
                   const dxValue = calcValue % 2;
                   result.display = dxValue === 0 ? 'å°' : 'å¤§';
                   result.numbers = getNumbersByBigSmall(dxValue);
                   break;
                   
               case 'æ€åˆå¤§å°':
                   const hdxValue = calcValue % 2;
                   result.display = hdxValue === 0 ? 'åˆå°' : 'åˆå¤§';
                   result.numbers = getNumbersByHeBigSmall(hdxValue);
                   break;
                   
               case 'æ€åˆå•åŒ':
                   const hdsValue = calcValue % 2;
                   result.display = hdsValue === 0 ? 'åˆåŒ' : 'åˆå•';
                   result.numbers = getNumbersByHeOddEven(hdsValue);
                   break;
                   
               case 'æ€å°¾å¤§å°':
                   const wdxValue = calcValue % 2;
                   result.display = wdxValue === 0 ? 'å°¾å°' : 'å°¾å¤§';
                   result.numbers = getNumbersByWeiBigSmall(wdxValue);
                   break;
                   
               case 'æ€ä¸ƒä½™':
                   const yu7Value = calcValue % 7;
                   result.display = '7ä½™' + yu7Value;
                   result.numbers = getNumbersByYu7(yu7Value);
                   break;
                   
               case 'æ€å…­ä½™':
                   const yu6Value = calcValue % 6;
                   result.display = '6ä½™' + yu6Value;
                   result.numbers = getNumbersByYu6(yu6Value);
                   break;
                   
               case 'æ€äº”ä½™':
                   const yu5Value = calcValue % 5;
                   result.display = '5ä½™' + yu5Value;
                   result.numbers = getNumbersByYu5(yu5Value);
                   break;
                   
               case 'æ€å››ä½™':
                   const yu4Value = calcValue % 4;
                   result.display = '4ä½™' + yu4Value;
                   result.numbers = getNumbersByYu4(yu4Value);
                   break;
                   
               case 'æ€ä¸‰ä½™':
                   const yu3Value = calcValue % 3;
                   result.display = '3ä½™' + yu3Value;
                   result.numbers = getNumbersByYu3(yu3Value);
                   break;
                   
               case 'æ€ä¸€åˆ':
                   let heValue = calcValue % 13;
                   if (heValue === 0) heValue = 13;
                   result.display = String(heValue).padStart(2, '0') + 'åˆ';
                   result.numbers = getNumbersByHe(heValue);
                   break;
                   
               case 'æ€åŠå¤´':
                   const bantouValue = calcValue % 10;
                   result.display = getHalfHeadName(bantouValue);
                   result.numbers = getNumbersByHalfHead(bantouValue);
                   break;
                   
               case 'æ€ä¸ƒè‚–':
                   const qixiaoValue = calcValue % 12;
                   result.display = 'ä¸ƒè‚–';
                   result.numbers = getNumbersBySevenZodiac(qixiaoValue, period);
                   break;
                   
               case 'æ€ä¹è‚–':
                   const jiuxiaoValue = calcValue % 12;
                   result.display = 'ä¹è‚–';
                   result.numbers = getNumbersByNineZodiac(jiuxiaoValue, period);
                   break;
                   
               case 'æ€å¹³ç‰¹è‚–':
                   const pingtexiaoValue = calcValue % 12;
                   result.display = 'å¹³ç‰¹è‚–';
                   result.numbers = getNumbersByPingteZodiac(pingtexiaoValue, period);
                   break;
                   
               default:
                   let defaultValue = calcValue % 49;
                   if (defaultValue === 0) defaultValue = 49;
                   result.display = String(defaultValue).padStart(2, '0');
                   result.numbers = [defaultValue];
           }
           
           return result;
       }

       // è¾…åŠ©å‡½æ•°å®šä¹‰ï¼ˆä¿æŒåŸæœ‰å®ç°ï¼‰
       function getNumbersByHeWei(hewei) {
           const heweiMap = {
               0: [19,28,37,46],
               1: [1,10,29,38,47],
               2: [2,11,20,39,48],
               3: [3,12,21,30,49],
               4: [4,13,22,31,40],
               5: [5,14,23,32,41],
               6: [6,15,24,33,42],
               7: [7,16,25,34,43],
               8: [8,17,26,35,44],
               9: [9,18,27,36,45]
           };
           return heweiMap[hewei] || [];
       }

       function getNumbersBySection(duan, range) {
           const sections = {
               0: [1,2,3,4,5,6,7],
               1: [1,2,3,4,5,6,7],
               2: [8,9,10,11,12,13,14],
               3: [15,16,17,18,19,20,21],
               4: [22,23,24,25,26,27,28],
               5: [29,30,31,32,33,34,35],
               6: [36,37,38,39,40,41,42],
               7: [43,44,45,46,47,48,49]
           };
           return sections[duan] || [];
       }

       function getHalfColorName(value) {
           const names = ['çº¢åŒ', 'çº¢å•', 'è“åŒ', 'è“å•', 'ç»¿åŒ', 'ç»¿å•'];
           return names[value] || 'çº¢åŒ';
       }

       function getNumbersByHalfColor(value) {
           const halfColorMap = {
               0: [2,8,12,18,24,30,34,40,46],
               1: [1,7,13,19,23,29,35,45],
               2: [4,10,14,20,26,36,42,48],
               3: [3,9,15,25,31,37,41,47],
               4: [6,16,22,28,32,38,44],
               5: [5,11,17,21,27,33,39,43,49]
           };
           return halfColorMap[value] || [];
       }

       function getNumbersByElement(element, period) {
           const year = parseInt(period.substring(0, 4));
           const config = elementConfigs[year] || elementConfigs[2025];
           return config[element] || [];
       }

       function getBigSmallOddEvenName(value) {
           const names = ['å°åŒ', 'å°å•', 'å¤§åŒ', 'å¤§å•'];
           return names[value] || 'å°åŒ';
       }

       function getNumbersByBigSmallOddEven(value) {
           const dxdMap = {
               0: [2,4,6,8,10,12,14,16,18,20,22,24],
               1: [1,3,5,7,9,11,13,15,17,19,21,23],
               2: [26,28,30,32,34,36,38,40,42,44,46,48],
               3: [25,27,29,31,33,35,37,39,41,43,45,47,49]
           };
           return dxdMap[value] || [];
       }

       function getNumbersByOddEven(value) {
           const numbers = [];
           for (let i = 1; i <= 49; i++) {
               if ((i % 2 === 0 && value === 0) || (i % 2 === 1 && value === 1)) {
                   numbers.push(i);
               }
           }
           return numbers;
       }

       function getNumbersByBigSmall(value) {
           const numbers = [];
           for (let i = 1; i <= 49; i++) {
               if ((i <= 24 && value === 0) || (i >= 25 && value === 1)) {
                   numbers.push(i);
               }
           }
           return numbers;
       }

       function getNumbersByHeBigSmall(value) {
           const numbers = [];
           for (let i = 1; i <= 49; i++) {
               const he = Math.floor(i / 10) + (i % 10);
               if ((he <= 6 && value === 0) || (he >= 7 && value === 1)) {
                   numbers.push(i);
               }
           }
           return numbers;
       }

       function getNumbersByHeOddEven(value) {
           const numbers = [];
           for (let i = 1; i <= 49; i++) {
               const he = Math.floor(i / 10) + (i % 10);
               if ((he % 2 === 0 && value === 0) || (he % 2 === 1 && value === 1)) {
                   numbers.push(i);
               }
           }
           return numbers;
       }

       function getNumbersByWeiBigSmall(value) {
           const numbers = [];
           for (let i = 1; i <= 49; i++) {
               const wei = i % 10;
               if ((wei <= 4 && value === 0) || (wei >= 5 && value === 1)) {
                   numbers.push(i);
               }
           }
           return numbers;
       }

       function getNumbersByYu7(value) {
           const yu7Map = {
               0: [7,14,21,28,35,42,49],
               1: [1,8,15,22,29,36,43],
               2: [2,9,16,23,30,37,44],
               3: [3,10,17,24,31,38,45],
               4: [4,11,18,25,32,39,46],
               5: [5,12,19,26,33,40,47],
               6: [6,13,20,27,34,41,48]
           };
           return yu7Map[value] || [];
       }

       function getNumbersByYu6(value) {
           const yu6Map = {
               0: [6,12,18,24,30,36,42,48],
               1: [1,7,13,19,25,31,37,43,49],
               2: [2,8,14,20,26,32,38,44],
               3: [3,9,15,21,27,33,39,45],
               4: [4,10,16,22,28,34,40,46],
               5: [5,11,17,23,29,35,41,47]
           };
           return yu6Map[value] || [];
       }

       function getNumbersByYu5(value) {
           const yu5Map = {
               0: [5,10,15,20,25,30,35,40,45],
               1: [1,6,11,16,21,26,31,36,41,46],
               2: [2,7,12,17,22,27,32,37,42,47],
               3: [3,8,13,18,23,28,33,38,43,48],
               4: [4,9,14,19,24,29,34,39,44,49]
           };
           return yu5Map[value] || [];
       }

       function getNumbersByYu4(value) {
           const yu4Map = {
               0: [4,8,12,16,20,24,28,32,36,40,44,48],
               1: [1,5,9,13,17,21,25,29,33,37,41,45,49],
               2: [2,6,10,14,18,22,26,30,34,38,42,46],
               3: [3,7,11,15,19,23,27,31,35,39,43,47]
           };
           return yu4Map[value] || [];
       }

       function getNumbersByYu3(value) {
           const yu3Map = {
               0: [3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48],
               1: [1,4,7,10,13,16,19,22,25,28,31,34,37,40,43,46,49],
               2: [2,5,8,11,14,17,20,23,26,29,32,35,38,41,44,47]
           };
           return yu3Map[value] || [];
       }

       function getNumbersByHe(heValue) {
           const heMap = {
               1: [1,10],
               2: [2,11,20],
               3: [3,12,21,30],
               4: [4,13,22,31,40],
               5: [5,14,23,32,41],
               6: [6,15,24,33,42],
               7: [7,16,25,34,43],
               8: [8,17,26,35,44],
               9: [9,18,27,36,45],
               10: [19,28,37,46],
               11: [29,38,47],
               12: [39,48],
               13: [49]
           };
           return heMap[heValue] || [];
       }

       function getHalfHeadName(value) {
           const names = {
               0: '0å¤´åŒ', 1: '0å¤´å•', 2: '1å¤´åŒ', 3: '1å¤´å•',
               4: '2å¤´åŒ', 5: '2å¤´å•', 6: '3å¤´åŒ', 7: '3å¤´å•',
               8: '4å¤´åŒ', 9: '4å¤´å•'
           };
           return names[value] || '0å¤´åŒ';
       }

       function getNumbersByHalfHead(value) {
           const halfHeadMap = {
               0: [2,4,6,8],
               1: [1,3,5,7,9],
               2: [10,12,14,16,18],
               3: [11,13,15,17,19],
               4: [20,22,24,26,28],
               5: [21,23,25,27,29],
               6: [30,32,34,36,38],
               7: [31,33,35,37,39],
               8: [40,42,44,46,48],
               9: [41,43,45,47,49]
           };
           return halfHeadMap[value] || [];
       }

       function getNumbersBySevenZodiac(value, period) {
           const year = parseInt(period.substring(0, 4));
           const zodiacData = zodiacYearData[year] || zodiacYearData[2025];
           const zodiacNames = Object.keys(zodiacData.mapping);
           
           const numbers = [];
           for (let i = -3; i <= 3; i++) {
               let index = (value + i + 12) % 12;
               const zodiacName = zodiacNames[index];
               numbers.push(...zodiacData.mapping[zodiacName]);
           }
           return [...new Set(numbers)];
       }

       function getNumbersByNineZodiac(value, period) {
           const year = parseInt(period.substring(0, 4));
           const zodiacData = zodiacYearData[year] || zodiacYearData[2025];
           const zodiacNames = Object.keys(zodiacData.mapping);
           
           const numbers = [];
           for (let i = -4; i <= 4; i++) {
               let index = (value + i + 12) % 12;
               const zodiacName = zodiacNames[index];
               numbers.push(...zodiacData.mapping[zodiacName]);
           }
           return [...new Set(numbers)];
       }

       function getNumbersByPingteZodiac(value, period) {
           const year = parseInt(period.substring(0, 4));
           const zodiacData = zodiacYearData[year] || zodiacYearData[2025];
           const zodiacNames = Object.keys(zodiacData.mapping);
           const zodiacName = zodiacNames[value];
           
           return zodiacData.mapping[zodiacName] || [];
       }

       // éªŒè¯æ€é¡¹æ˜¯å¦å‡ºç°
       function verifyKillAppeared(killResult, killType, nextData, verifyTarget) {
           let numbersToCheck = [];
           if (verifyTarget === 'ç‰¹ç ') {
               numbersToCheck = [nextData.special];
           } else if (verifyTarget === 'å¹³ç ') {
               numbersToCheck = nextData.numbers;
           } else if (verifyTarget === 'å¹³ç‰¹') {
               numbersToCheck = [...nextData.numbers, nextData.special];
           } else if (verifyTarget.startsWith('å¹³')) {
               const pos = parseInt(verifyTarget.replace('å¹³', '').replace('ä½', '')) - 1;
               numbersToCheck = [nextData.numbers[pos]];
           }
           for (let num of numbersToCheck) {
               if (killResult.numbers.includes(num)) return true;
           }
           return false;
       }

       // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
       function calculateStats(results) {
           const total = results.length;
           const hits = results.filter(r => r.isHit).length;
           const hitRate = total > 0 ? ((hits / total) * 100).toFixed(2) : 0;
           
           let maxWin = 0, maxLose = 0, currentWin = 0, currentLose = 0;
           results.forEach(result => {
               if (result.isHit) {
                   currentWin++;
                   currentLose = 0;
                   maxWin = Math.max(maxWin, currentWin);
               } else {
                   currentLose++;
                   currentWin = 0;
                   maxLose = Math.max(maxLose, currentLose);
               }
               result.currentStreak = result.isHit ? currentWin : -currentLose;
           });
           
           return { total, hits, misses: total - hits, hitRate, maxWin, maxLose };
       }

       // ç”Ÿæˆç»Ÿè®¡HTML
       function generateStatsHTML(stats) {
           return `
               <div class="stat-card"><div class="label">æ€»éªŒè¯æœŸæ•°</div><div class="value">${stats.total}</div></div>
               <div class="stat-card"><div class="label">å‘½ä¸­æ¬¡æ•°</div><div class="value">${stats.hits}</div></div>
               <div class="stat-card"><div class="label">æœªä¸­æ¬¡æ•°</div><div class="value">${stats.misses}</div></div>
               <div class="stat-card"><div class="label">å‘½ä¸­ç‡</div><div class="value">${stats.hitRate}%</div></div>
               <div class="stat-card"><div class="label">æœ€å¤§è¿å¯¹</div><div class="value">${stats.maxWin}æœŸ</div></div>
               <div class="stat-card"><div class="label">æœ€å¤§è¿é”™</div><div class="value">${stats.maxLose}æœŸ</div></div>
           `;
       }

       // ç”Ÿæˆç»“æœè¡¨æ ¼
       function generateResultTable(results) {
           let html = `
               <table class="result-table">
                   <thead>
                       <tr>
                           <th>æœŸå·</th>
                           <th>å¼€å¥–å·ç </th>
                           <th>è¯¦ç»†è®¡ç®—</th>
                           <th>è®¡ç®—å€¼</th>
                           <th>æ€é¡¹</th>
                           <th>çŠ¶æ€</th>
                           <th>è¿ç»­</th>
                       </tr>
                   </thead>
                   <tbody>
           `;
           results.forEach(result => {
               const numbersDisplay = result.numbers.map(n => String(n).padStart(2, '0')).join(' ');
               const specialDisplay = String(result.special).padStart(2, '0');
               const calcDetailHTML = result.calcDetails.map(d => `<div class="calc-step">${d}</div>`).join('');
               const streakText = result.currentStreak > 0 ? `è¿å¯¹${result.currentStreak}` : `è¿é”™${Math.abs(result.currentStreak)}`;
               html += `
                   <tr>
                       <td>${result.period}</td>
                       <td style="font-family: monospace;">${numbersDisplay} <span style="color:red">+${specialDisplay}</span></td>
                       <td style="text-align: left;"><div class="calc-detail">${calcDetailHTML}</div></td>
                       <td><strong>${result.calcValue}</strong></td>
                       <td><strong>${result.killType}: ${result.killResult.display}</strong></td>
                       <td class="${result.isHit ? 'hit' : 'miss'}">${result.isHit ? 'âœ… å‘½ä¸­' : 'âŒ æœªä¸­'}</td>
                       <td>${streakText}</td>
                   </tr>
               `;
           });
           html += '</tbody></table>';
           return html;
       }

       // å¯¼å‡ºåˆ°Excel
       function exportToExcel() {
           if (calculationResults.length === 0 && batchResults.length === 0) {
               alert('âŒ æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®ï¼');
               return;
           }
           let csv = '\uFEFF';
           if (batchResults.length > 0) {
               batchResults.forEach((batch, index) => {
                   csv += `\nå…¬å¼${index + 1}: ${batch.formula}\n`;
                   csv += 'æœŸå·,å¼€å¥–å·ç ,è®¡ç®—è¿‡ç¨‹,è®¡ç®—å€¼,æ€é¡¹,çŠ¶æ€\n';
                   batch.results.forEach(r => {
                       const numbers = r.numbers.map(n => String(n).padStart(2, '0')).join(' ') + ' + ' + String(r.special).padStart(2, '0');
                       const calcProcess = r.calcDetails.join(' + ');
                       const status = r.isHit ? 'å‘½ä¸­' : 'æœªä¸­';
                       csv += `${r.period},"${numbers}","${calcProcess}",${r.calcValue},${r.killResult.display},${status}\n`;
                   });
               });
           } else {
               csv += 'æœŸå·,å¼€å¥–å·ç ,è®¡ç®—è¿‡ç¨‹,è®¡ç®—å€¼,æ€é¡¹,çŠ¶æ€\n';
               calculationResults.forEach(r => {
                   const numbers = r.numbers.map(n => String(n).padStart(2, '0')).join(' ') + ' + ' + String(r.special).padStart(2, '0');
                   const calcProcess = r.calcDetails.join(' + ');
                   const status = r.isHit ? 'å‘½ä¸­' : 'æœªä¸­';
                   csv += `${r.period},"${numbers}","${calcProcess}",${r.calcValue},${r.killResult.display},${status}\n`;
               });
           }
           
           const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
           const link = document.createElement('a');
           link.href = URL.createObjectURL(blob);
           link.download = `å…­åˆå…¬å¼éªŒè¯_${new Date().getTime()}.csv`;
           link.click();
       }

       // æ˜¾ç¤ºæ¶ˆæ¯
       function showMessage(elementId, message, type) {
           const element = document.getElementById(elementId);
           element.className = type === 'error' ? 'error-message' : 'success-message';
           element.textContent = message;
           element.style.display = 'block';
           setTimeout(() => element.style.display = 'none', 3000);
       }

       // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
       window.onload = function() {
           const exampleData = `2025001 37 34 09 46 16 30 33
2025002 16 27 28 33 12 38 44
2025003 39 49 03 20 25 43 38`;
           document.getElementById('dataInput').value = exampleData;
           updateSettings();
       };
   </script>
</body>
</html>
